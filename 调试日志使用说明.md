# è°ƒè¯•æ—¥å¿—åŠŸèƒ½ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

ç³»ç»Ÿå·²é›†æˆå®Œæ•´çš„è°ƒè¯•æ—¥å¿—åŠŸèƒ½ï¼Œæ‰€æœ‰æ“ä½œéƒ½ä¼šè®°å½•è¯¦ç»†çš„æ—¶é—´æˆ³å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. æ—¶é—´æˆ³è®°å½•
æ‰€æœ‰æ—¥å¿—éƒ½å¸¦æœ‰ç²¾ç¡®åˆ°æ¯«ç§’çš„æ—¶é—´æˆ³ï¼š
```
[2025-11-01 17:45:23.456] [INFO] å¼€å§‹è·å–å…¬å‘Šæ•°æ® | symbol=000001 | days=30
```

### 2. æ—¥å¿—çº§åˆ«
- **INFO**: æ­£å¸¸ä¿¡æ¯æµ
- **DEBUG**: è¯¦ç»†è°ƒè¯•ä¿¡æ¯
- **WARNING**: è­¦å‘Šä¿¡æ¯
- **ERROR**: é”™è¯¯ä¿¡æ¯ï¼ˆåŒ…å«å¼‚å¸¸å †æ ˆï¼‰
- **STEP**: æµç¨‹æ­¥éª¤
- **CALL**: å‡½æ•°è°ƒç”¨
- **RETURN**: å‡½æ•°è¿”å›
- **DATA**: æ•°æ®ä¿¡æ¯

### 3. ä¸Šä¸‹æ–‡ä¿¡æ¯
æ¯æ¡æ—¥å¿—éƒ½åŒ…å«ç›¸å…³çš„ä¸Šä¸‹æ–‡å‚æ•°ï¼Œä¾¿äºè¿½è¸ªé—®é¢˜ã€‚

---

## ğŸ“Š å·²é›†æˆçš„æ¨¡å—

### 1. `unified_data_access.py` - æ•°æ®è®¿é—®å±‚
**é›†æˆä½ç½®**:
- `get_announcement_data()` æ–¹æ³•
  - å¼€å§‹æ—¶è®°å½•å‚æ•°
  - å¼‚å¸¸æ—¶è®°å½•è¯¦ç»†é”™è¯¯
  - å®Œæˆæ—¶è®°å½•ç»“æœç»Ÿè®¡

**æ—¥å¿—ç¤ºä¾‹**:
```
[2025-11-01 17:45:23.456] [INFO] å¼€å§‹è·å–å…¬å‘Šæ•°æ® | symbol=000001 | days=30 | method=get_announcement_data
[2025-11-01 17:45:23.460] [DEBUG] è¿›å…¥å…¬å‘Šæ•°æ®è·å–tryå— | symbol=000001
[2025-11-01 17:45:26.789] [INFO] å…¬å‘Šæ•°æ®è·å–å®Œæˆ | symbol=000001 | success=True | count=5 | elapsed=3.33s
```

### 2. `ai_agents.py` - AIåˆ†æå±‚
**é›†æˆä½ç½®**:
- `run_multi_agent_analysis()` æ–¹æ³•
  - åˆ†æå¼€å§‹æ—¶è®°å½•è‚¡ç¥¨ä¿¡æ¯
  - è®°å½•æ‰€æœ‰è¾“å…¥æ•°æ®çš„ç±»å‹å’Œå¤§å°

**æ—¥å¿—ç¤ºä¾‹**:
```
================================================================================
[2025-11-01 17:45:30.123] [STEP] Step 1: å¼€å§‹å¤šæ™ºèƒ½ä½“åˆ†æ | symbol=000001 | stock_name=å¹³å®‰é“¶è¡Œ
================================================================================
[2025-11-01 17:45:30.125] [DATA] Data info for stock_info | name=stock_info | type=dict | keys=['symbol', 'name', 'current_price'] | length=10
[2025-11-01 17:45:30.127] [DATA] Data info for announcement_data | name=announcement_data | type=dict | keys=['symbol', 'announcements', 'data_success'] | length=5
```

### 3. `app.py` - ä¸»åº”ç”¨å±‚
**é›†æˆä½ç½®**:
- `run_stock_analysis()` å‡½æ•°
  - åˆ†ææµç¨‹å¼€å§‹
  - æ•°æ®è·å–å®Œæˆ
  - å¼‚å¸¸å¤„ç†å¢å¼º

**æ—¥å¿—ç¤ºä¾‹**:
```
================================================================================
[2025-11-01 17:45:20.001] [STEP] Step 1: å¼€å§‹è‚¡ç¥¨åˆ†ææµç¨‹ | symbol=000001 | period=1y
================================================================================
[2025-11-01 17:45:20.005] [INFO] å¼€å§‹è·å–è‚¡ç¥¨åŸºç¡€æ•°æ® | symbol=000001 | period=1y
[2025-11-01 17:45:22.345] [DATA] Data info for stock_info_result | name=stock_info_result | type=dict | keys=['symbol', 'name'] | length=15
```

---

## ğŸ› ï¸ ä¸»è¦æ”¹è¿›

### 1. å®‰å…¨çš„ `.index()` æ“ä½œ
**é—®é¢˜**: åŸä»£ç ä½¿ç”¨ `list.index()` å¯èƒ½æŠ›å‡º `ValueError` æˆ– `AttributeError`

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ `safe_index()` å‡½æ•°

**æ”¹è¿›ä½ç½®**:
- `app.py` ç¬¬ 1937 è¡Œ: æŠ•èµ„è¯„çº§é€‰æ‹©
- `app.py` ç¬¬ 2296 è¡Œ: ä»£ç†é‰´æƒæ–¹å¼é€‰æ‹©
- `app.py` ç¬¬ 2892 è¡Œ: æ‰¹é‡åˆ†æç»“æœé€‰æ‹©

**ä½¿ç”¨ç¤ºä¾‹**:
```python
# æ—§ä»£ç ï¼ˆå¯èƒ½å‡ºé”™ï¼‰
index = ["ä¹°å…¥", "æŒæœ‰", "å–å‡º"].index(rating)

# æ–°ä»£ç ï¼ˆå®‰å…¨ï¼‰
from debug_logger import safe_index
index = safe_index(["ä¹°å…¥", "æŒæœ‰", "å–å‡º"], rating, default=0)
```

**æ—¥å¿—è¾“å‡º**ï¼ˆå½“å…ƒç´ ä¸å­˜åœ¨æ—¶ï¼‰:
```
[2025-11-01 17:45:25.123] [WARNING] Item not found in list | item=è§‚æœ› | list_items=['ä¹°å…¥', 'æŒæœ‰', 'å–å‡º'] | returning=0
```

---

## ğŸ“ æ—¥å¿—æ–‡ä»¶

### è‡ªåŠ¨ä¿å­˜
æ‰€æœ‰æ—¥å¿—ä¼šè‡ªåŠ¨ä¿å­˜åˆ° `debug.log` æ–‡ä»¶ä¸­ï¼Œä¾¿äºäº‹ååˆ†æã€‚

### æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹å®Œæ•´æ—¥å¿—
cat debug.log

# æŸ¥çœ‹æœ€æ–°100è¡Œ
tail -100 debug.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "\[ERROR\]" debug.log

# æŸ¥çœ‹ç‰¹å®šè‚¡ç¥¨çš„æ—¥å¿—
grep "symbol=000001" debug.log

# å®æ—¶ç›‘æ§æ—¥å¿—
tail -f debug.log
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. å¿«é€Ÿå®šä½é”™è¯¯
å½“å‡ºç° `'dict' object has no attribute 'index'` é”™è¯¯æ—¶ï¼š

```bash
# æŸ¥æ‰¾ç›¸å…³æ—¥å¿—
grep -A 10 -B 10 "ERROR" debug.log | tail -50
```

æ—¥å¿—ä¼šæ˜¾ç¤ºï¼š
- é”™è¯¯å‘ç”Ÿçš„ç²¾ç¡®æ—¶é—´
- é”™è¯¯ç±»å‹å’Œæ¶ˆæ¯
- å®Œæ•´çš„å †æ ˆè·Ÿè¸ª
- ç›¸å…³çš„ä¸Šä¸‹æ–‡å‚æ•°ï¼ˆsymbol, periodç­‰ï¼‰

### 2. è¿½è¸ªæ•°æ®æµ
ä½¿ç”¨ `DATA` çº§åˆ«æ—¥å¿—è¿½è¸ªæ•°æ®ï¼š

```bash
grep "\[DATA\]" debug.log | grep "announcement"
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
[2025-11-01 17:45:23.789] [DATA] Data info for announcement_data | type=dict | keys=['symbol', 'announcements'] | length=6
```

### 3. æ€§èƒ½åˆ†æ
ä½¿ç”¨ `elapsed` å‚æ•°åˆ†ææ€§èƒ½ï¼š

```bash
grep "elapsed=" debug.log
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
[2025-11-01 17:45:26.789] [INFO] å…¬å‘Šæ•°æ®è·å–å®Œæˆ | elapsed=3.33s
[2025-11-01 17:46:15.234] [INFO] AIåˆ†æå®Œæˆ | elapsed=48.45s
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: è°ƒè¯•å…¬å‘Šæ•°æ®è·å–å¤±è´¥

**ç°è±¡**: ç”¨æˆ·æŠ¥å‘Šå…¬å‘Šæ•°æ®è·å–å¤±è´¥

**æ­¥éª¤**:
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
```bash
grep "get_announcement_data" debug.log | tail -20
```

2. æŸ¥çœ‹è¾“å‡ºï¼š
```
[2025-11-01 17:45:23.456] [INFO] å¼€å§‹è·å–å…¬å‘Šæ•°æ® | symbol=000001 | days=30
[2025-11-01 17:45:23.460] [DEBUG] è¿›å…¥å…¬å‘Šæ•°æ®è·å–tryå— | symbol=000001
[2025-11-01 17:45:24.567] [ERROR] è·å–å…¬å‘Šå¤±è´¥ | symbol=000001 | days=30
  Exception Type: KeyError
  Exception Message: 'announcements'
  Traceback:
    File "unified_data_access.py", line 245, in get_announcement_data
      announcements = data['announcements']
```

3. æ ¹æ®é”™è¯¯ä¿¡æ¯å®šä½é—®é¢˜ï¼šæ•°æ®ç»“æ„ä¸­ç¼ºå°‘ 'announcements' é”®

### åœºæ™¯2: è°ƒè¯• `.index()` é”™è¯¯

**ç°è±¡**: `'dict' object has no attribute 'index'`

**æ­¥éª¤**:
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```bash
grep "AttributeError" debug.log -A 5
```

2. æŸ¥çœ‹è°ƒç”¨ä½ç½®ï¼š
```
[2025-11-01 17:45:25.123] [ERROR] safe_index called with non-list type
  Exception Type: TypeError
  Expected list, got dict
```

3. å®šä½åˆ°ä»£ç ä¸­ä¼ é”™äº†å‚æ•°ç±»å‹ï¼Œåº”è¯¥æ˜¯ list å´ä¼ äº† dict

### åœºæ™¯3: æ€§èƒ½ä¼˜åŒ–

**ç›®æ ‡**: æ‰¾å‡ºæœ€æ…¢çš„ç¯èŠ‚

**æ­¥éª¤**:
```bash
grep "elapsed=" debug.log | sort -t= -k2 -n | tail -10
```

è¾“å‡ºï¼š
```
[2025-11-01 17:45:26.789] [INFO] å…¬å‘Šæ•°æ®è·å–å®Œæˆ | elapsed=3.33s
[2025-11-01 17:45:30.123] [INFO] èµ„é‡‘æµå‘æ•°æ®è·å–å®Œæˆ | elapsed=5.67s
[2025-11-01 17:46:15.234] [INFO] AIåˆ†æå®Œæˆ | elapsed=48.45s  â† æœ€æ…¢
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### å¯ç”¨/ç¦ç”¨è°ƒè¯•æ¨¡å¼

ä¿®æ”¹ `debug_logger.py`:
```python
# å…¨å±€æ—¥å¿—å™¨å®ä¾‹
debug_logger = DebugLogger(enable_debug=True)  # True=å¼€å¯, False=å…³é—­
```

### è‡ªå®šä¹‰æ—¥å¿—æ–‡ä»¶ä½ç½®

ä¿®æ”¹ `debug_logger.py`:
```python
def __init__(self, enable_debug: bool = True):
    self.enable_debug = enable_debug
    self.log_file = "debug.log"  # ä¿®æ”¹è¿™é‡Œ
```

---

## ğŸš€ æœ€ä½³å®è·µ

### 1. åœ¨å…³é”®ç‚¹æ·»åŠ æ—¥å¿—

```python
def critical_function(param1, param2):
    debug_logger.info("å¼€å§‹æ‰§è¡Œå…³é”®æ“ä½œ", param1=param1, param2=param2)
    
    try:
        result = do_something(param1, param2)
        debug_logger.info("æ“ä½œæˆåŠŸ", result_type=type(result).__name__)
        return result
    except Exception as e:
        debug_logger.error("æ“ä½œå¤±è´¥", error=e, param1=param1, param2=param2)
        raise
```

### 2. è®°å½•æ•°æ®ç»“æ„ä¿¡æ¯

```python
debug_logger.data_info("user_input", user_data)
# è¾“å‡º: [DATA] Data info for user_input | type=dict | keys=['name', 'age'] | length=2
```

### 3. ä½¿ç”¨ safe_index é¿å…å´©æºƒ

```python
# æ€»æ˜¯ä½¿ç”¨ safe_index è€Œä¸æ˜¯ç›´æ¥ .index()
from debug_logger import safe_index

options = ["option1", "option2", "option3"]
user_choice = "option4"  # ç”¨æˆ·å¯èƒ½è¾“å…¥ä¸å­˜åœ¨çš„é€‰é¡¹

# å®‰å…¨çš„åšæ³•
index = safe_index(options, user_choice, default=0)
# æ—¥å¿—ä¼šè®°å½•è­¦å‘Šï¼Œä½†ç¨‹åºä¸ä¼šå´©æºƒ
```

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

- âœ… `debug_logger.py` - è°ƒè¯•æ—¥å¿—æ ¸å¿ƒæ¨¡å—
- âœ… `unified_data_access.py` - å·²é›†æˆæ—¥å¿—
- âœ… `ai_agents.py` - å·²é›†æˆæ—¥å¿—
- âœ… `app.py` - å·²é›†æˆæ—¥å¿—å’Œsafe_index
- âœ… `debug.log` - è‡ªåŠ¨ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶
- âœ… `è°ƒè¯•æ—¥å¿—ä½¿ç”¨è¯´æ˜.md` - æœ¬æ–‡æ¡£

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›
1. âœ… æ‰€æœ‰æ—¥å¿—éƒ½æœ‰ç²¾ç¡®æ—¶é—´æˆ³
2. âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
3. âœ… å®‰å…¨çš„ `.index()` æ“ä½œ
4. âœ… ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
5. âœ… è‡ªåŠ¨ä¿å­˜åˆ°æ–‡ä»¶

### é—®é¢˜è§£å†³èƒ½åŠ›
- âœ… å¿«é€Ÿå®šä½é”™è¯¯ä½ç½®
- âœ… äº†è§£æ•°æ®æµè½¬è¿‡ç¨‹
- âœ… åˆ†ææ€§èƒ½ç“¶é¢ˆ
- âœ… è¿½è¸ªå‚æ•°å˜åŒ–

### ä½¿ç”¨å»ºè®®
1. å®šæœŸæ£€æŸ¥ `debug.log` æ–‡ä»¶
2. å‡ºç°é”™è¯¯æ—¶å…ˆæŸ¥çœ‹æ—¥å¿—
3. åœ¨å…³é”®ç‚¹æ·»åŠ è‡ªå®šä¹‰æ—¥å¿—
4. ä½¿ç”¨ `safe_index` é¿å…å´©æºƒ

---

**ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-11-01  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•

