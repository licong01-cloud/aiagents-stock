# æ—§ç‰ˆæ•°æ®è·å–åŠŸèƒ½å¯¹æ¯”åˆ†æ

## ğŸ“‹ åˆ†æç›®æ ‡

å¯¹æ¯” `newdoc` æ–‡ä»¶å¤¹ä¸­çš„æ—§ç‰ˆå®ç°ä¸ç°æœ‰ç¨‹åºçš„å·®å¼‚ï¼š
1. **data_source_manager_old.py** vs **data_source_manager.py**
2. **unified_data_api_old.py** vs **unified_data_access.py**

---

## 1. data_source_manager_old.py vs data_source_manager.py

### ğŸ“– æ—§ç‰ˆæ–‡ä»¶ (data_source_manager_old.py)

**æ–‡ä»¶å¤§å°**: 1767è¡Œ  
**æ ¸å¿ƒç‰¹ç‚¹**:
- æ‰‹åŠ¨ç®¡ç†ä»£ç†ç¯å¢ƒå˜é‡ï¼ˆæ¸…é™¤å’Œæ¢å¤ï¼‰
- ä½¿ç”¨ `standard_network_api.get_akshare_data()` ä½œä¸ºAkshareå¤‡ç”¨æ¥å£
- Tushareä¼˜å…ˆï¼Œæ‰‹åŠ¨æ¸…é™¤HTTP/HTTPS_PROXYç¡®ä¿ç›´è¿
- ç ”æŠ¥æ•°æ®ä½¿ç”¨Tushare `report_rc` æ¥å£ï¼ŒåŒ…å«å®Œæ•´çš„ç»Ÿè®¡åˆ†æ

### ğŸ” ç°æœ‰æ–‡ä»¶ (data_source_manager.py)

**æ–‡ä»¶å¤§å°**: çº¦367è¡Œï¼ˆç²¾ç®€ç‰ˆï¼‰  
**æ ¸å¿ƒç‰¹ç‚¹**:
- ä½¿ç”¨ `network_optimizer.apply()` ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- æ‰€æœ‰Akshareè°ƒç”¨éƒ½é€šè¿‡ `network_optimizer.apply()` åŒ…è£¹
- Tushareä¼˜å…ˆç­–ç•¥ä¿æŒä¸å˜
- **ç¼ºå¤±**: ç ”æŠ¥æ•°æ®è·å–æ–¹æ³•ï¼ˆå·²è¿ç§»åˆ° `unified_data_access.py`ï¼‰

---

### ğŸ“Š ä¸»è¦å·®å¼‚å¯¹æ¯”

| åŠŸèƒ½é¡¹ | æ—§ç‰ˆ (old) | ç°æœ‰ç‰ˆæœ¬ | å·®å¼‚è¯´æ˜ |
|--------|-----------|---------|---------|
| **ä»£ç†ç®¡ç†** | æ‰‹åŠ¨æ¸…é™¤/æ¢å¤ `HTTP_PROXY` ç¯å¢ƒå˜é‡ | ä½¿ç”¨ `network_optimizer.apply()` ä¸Šä¸‹æ–‡ç®¡ç†å™¨ | âœ… **ç°æœ‰ç‰ˆæœ¬æ›´ç®€æ´** |
| **Akshareè°ƒç”¨** | `standard_network_api.get_akshare_data()` | `network_optimizer.apply()` åŒ…è£¹ç›´æ¥è°ƒç”¨ | âš ï¸ **æ¥å£å˜æ›´** |
| **ç½‘ç»œä¼˜åŒ–** | é€šè¿‡ `standard_network_api` æ¨¡å— | é€šè¿‡ `network_optimizer` æ¨¡å— | âœ… **ç»Ÿä¸€ä¼˜åŒ–æ¥å£** |
| **ç ”æŠ¥æ•°æ®** | âœ… `get_research_reports_data()` (å®Œæ•´å®ç°) | âŒ å·²ç§»é™¤ï¼ˆè¿ç§»åˆ°unified_data_accessï¼‰ | âš ï¸ **åŠŸèƒ½è¿ç§»** |
| **ä»£ç è¡Œæ•°** | 1767è¡Œ | çº¦367è¡Œ | âœ… **ä»£ç ç²¾ç®€** |
| **é”™è¯¯å¤„ç†** | åŸºç¡€try-except | å¢å¼ºçš„ç±»å‹æ£€æŸ¥å’Œæ—¥å¿— | âœ… **æ›´å¥å£®** |

---

### ğŸ”§ è¯¦ç»†æŠ€æœ¯å·®å¼‚

#### 1. ä»£ç†ç¯å¢ƒå˜é‡ç®¡ç†

**æ—§ç‰ˆæ–¹å¼**ï¼ˆæ‰‹åŠ¨ç®¡ç†ï¼‰:
```python
# æ—§ç‰ˆï¼šæ‰‹åŠ¨æ¸…é™¤å’Œæ¢å¤ä»£ç†
old_http_proxy = os.environ.get('HTTP_PROXY')
old_https_proxy = os.environ.get('HTTPS_PROXY')

if 'HTTP_PROXY' in os.environ:
    del os.environ['HTTP_PROXY']
if 'HTTPS_PROXY' in os.environ:
    del os.environ['HTTPS_PROXY']

try:
    # Tushareè°ƒç”¨
    df = self.tushare_api.daily(...)
finally:
    # æ¢å¤ä»£ç†è®¾ç½®
    if old_http_proxy:
        os.environ['HTTP_PROXY'] = old_http_proxy
    if old_https_proxy:
        os.environ['HTTPS_PROXY'] = old_https_proxy
```

**ç°æœ‰æ–¹å¼**ï¼ˆä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼‰:
```python
# ç°æœ‰ï¼šä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
with network_optimizer.apply():
    df = self.tushare_api.daily(...)
    # è‡ªåŠ¨å¤„ç†ä»£ç†ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
```

**ä¼˜åŠ¿**:
- âœ… ä»£ç æ›´ç®€æ´
- âœ… è‡ªåŠ¨èµ„æºç®¡ç†
- âœ… å‡å°‘é—æ¼æ¢å¤ä»£ç†çš„é£é™©

---

#### 2. Akshareæ•°æ®è·å–æ–¹å¼

**æ—§ç‰ˆæ–¹å¼**:
```python
from standard_network_api import get_akshare_data

df = get_akshare_data(
    'stock_zh_a_hist',
    symbol=symbol,
    period="daily",
    start_date=start_date,
    end_date=end_date,
    adjust=adjust
)
```

**ç°æœ‰æ–¹å¼**:
```python
with network_optimizer.apply():
    import akshare as ak
    df = ak.stock_zh_a_hist(
        symbol=symbol,
        period="daily",
        start_date=start_date,
        end_date=end_date,
        adjust=adjust
    )
```

**å·®å¼‚**:
- âœ… ç°æœ‰ç‰ˆæœ¬ç›´æ¥è°ƒç”¨Akshareï¼Œæ›´ç›´è§‚
- âœ… ç»Ÿä¸€ä½¿ç”¨ `network_optimizer.apply()` ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- âš ï¸ ç§»é™¤äº† `standard_network_api` ä¸­é—´å±‚

---

#### 3. ç ”æŠ¥æ•°æ®è·å–

**æ—§ç‰ˆå®ç°**ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰:
```python
def get_research_reports_data(self, symbol: str, days: int = 90) -> Dict:
    """è·å–ç ”æŠ¥æ•°æ®ï¼ˆTushareä¼˜å…ˆï¼Œç›´è¿ï¼‰"""
    # ä½¿ç”¨Tushare report_rcæ¥å£
    df_reports = self.tushare_api.report_rc(
        ts_code=ts_code,
        start_date=start_date,
        end_date=end_date
    )
    
    # åŒ…å«å®Œæ•´çš„ç»Ÿè®¡åˆ†æ
    reports_analysis = self._analyze_research_reports(df_reports)
    # è¿”å›ï¼štotal_reports, reports_data, summary(æœºæ„ç»Ÿè®¡ã€è¯„çº§åˆ†å¸ƒã€ç›®æ ‡ä»·æ ¼ç­‰)
```

**ç°æœ‰å®ç°**ï¼ˆå·²è¿ç§»ï¼‰:
```python
# data_source_manager.py ä¸­å·²ç§»é™¤
# åŠŸèƒ½å·²è¿ç§»åˆ° unified_data_access.py
```

**è¿ç§»è¯´æ˜**:
- âš ï¸ æ—§ç‰ˆåœ¨ `data_source_manager` ä¸­å®ç°å®Œæ•´ç ”æŠ¥åˆ†æ
- âœ… ç°æœ‰ç‰ˆæœ¬å°†ç ”æŠ¥åŠŸèƒ½è¿ç§»åˆ° `unified_data_access.py`
- âš ï¸ ç°æœ‰ç‰ˆæœ¬çš„ç ”æŠ¥åˆ†æåŠŸèƒ½è¾ƒæ—§ç‰ˆç®€åŒ–ï¼ˆç¼ºå°‘ç»Ÿè®¡åˆ†æï¼‰

---

#### 4. å®æ—¶è¡Œæƒ…è·å–

**æ—§ç‰ˆæ–¹å¼**ï¼ˆå¤šçº§é™çº§ï¼‰:
```python
# 1. Tushare realtime_quoteï¼ˆå®æ—¶ï¼‰
# 2. Akshare stock_zh_a_spot_emï¼ˆå®æ—¶ï¼Œäº¤æ˜“æ—¶é—´å†…ï¼‰
# 3. Tushare dailyï¼ˆæ”¶ç›˜ä»·ï¼Œéå®æ—¶ï¼Œå›é€€æœ€è¿‘6ä¸ªäº¤æ˜“æ—¥ï¼‰
# 4. Tushareå†å²æ•°æ®ï¼ˆæœ€åå›é€€ï¼‰
```

**ç°æœ‰æ–¹å¼**ï¼ˆç®€åŒ–ï¼‰:
```python
# ä¼˜å…ˆä½¿ç”¨Tushareï¼Œé™çº§åˆ°Akshare
# é€šè¿‡network_optimizer.apply()åŒ…è£¹
```

**å·®å¼‚**:
- âš ï¸ æ—§ç‰ˆæœ‰æ›´è¯¦ç»†çš„é™çº§ç­–ç•¥å’Œäº¤æ˜“æ—¥åˆ¤æ–­
- âœ… ç°æœ‰ç‰ˆæœ¬ä»£ç æ›´ç®€æ´ï¼Œä½†åŠŸèƒ½å¯èƒ½ä¸å¦‚æ—§ç‰ˆå®Œæ•´

---

#### 5. èèµ„èåˆ¸æ•°æ®è·å–

**æ—§ç‰ˆæ–¹å¼**ï¼ˆè¯¦ç»†å®ç°ï¼‰:
```python
# 1. ä¸ªè‚¡èèµ„èåˆ¸æ˜ç»†ï¼ˆmargin_detailï¼‰
# 2. å¸‚åœºæ±‡æ€»èèµ„èåˆ¸æ•°æ®ï¼ˆmarginï¼‰
# 3. æœ€è¿‘10ä¸ªäº¤æ˜“æ—¥å›é€€
# 4. Akshareå¤‡ç”¨ï¼ˆstock_margin_underlying_info_szseï¼‰
```

**ç°æœ‰æ–¹å¼**:
```python
# ä¼˜å…ˆTushareï¼Œå¤±è´¥æ—¶ä½¿ç”¨Akshare
# é€šè¿‡network_optimizer.apply()åŒ…è£¹
```

**å·®å¼‚**:
- âš ï¸ æ—§ç‰ˆæœ‰æ›´è¯¦ç»†çš„å›é€€é€»è¾‘
- âœ… ç°æœ‰ç‰ˆæœ¬ä»£ç æ›´ç®€æ´

---

## 2. unified_data_api_old.py vs unified_data_access.py

### ğŸ“– æ—§ç‰ˆæ–‡ä»¶ (unified_data_api_old.py)

**æ–‡ä»¶å¤§å°**: 1122è¡Œ  
**æ ¸å¿ƒç‰¹ç‚¹**:
- ç‹¬ç«‹çš„ç»Ÿä¸€æ•°æ®APIç±» `UnifiedDataAPI`
- æ”¯æŒETFæ•°æ®ã€Betaç³»æ•°è®¡ç®—ã€52å‘¨é«˜ä½ä½ç­‰é«˜çº§åŠŸèƒ½
- èµ„é‡‘æµå‘å¤šçº§é™çº§ï¼šmoneyflow_ths â†’ moneyflow_dc â†’ moneyflow â†’ Akshare
- æ”¯æŒæ¿å—/è¡Œä¸šèµ„é‡‘æµå‘æ•°æ®è·å–
- ä½¿ç”¨ç½‘ç»œä¼˜åŒ–å™¨çš„ `_make_request_with_retry` æ–¹æ³•

### ğŸ” ç°æœ‰æ–‡ä»¶ (unified_data_access.py)

**æ–‡ä»¶å¤§å°**: çº¦1041è¡Œ  
**æ ¸å¿ƒç‰¹ç‚¹**:
- ç»Ÿä¸€æ•°æ®è®¿é—®æ¨¡å— `UnifiedDataAccess`
- ä¸»è¦ä½œä¸º `data_source_manager` çš„ä»£ç†å°è£…
- åŒ…å«ç ”æŠ¥ã€å…¬å‘Šã€ç­¹ç åˆ†å¸ƒç­‰æ–°åŠŸèƒ½
- ä½¿ç”¨ `network_optimizer.apply()` ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- **ç¼ºå¤±**: ETFæ•°æ®ã€Betaç³»æ•°ã€52å‘¨é«˜ä½ä½ç­‰é«˜çº§åŠŸèƒ½

---

### ğŸ“Š ä¸»è¦å·®å¼‚å¯¹æ¯”

| åŠŸèƒ½é¡¹ | æ—§ç‰ˆ (old) | ç°æœ‰ç‰ˆæœ¬ | å·®å¼‚è¯´æ˜ |
|--------|-----------|---------|---------|
| **æ¨¡å—å®šä½** | ç‹¬ç«‹ç»Ÿä¸€APIç±» | data_source_managerçš„ä»£ç†å°è£… | âš ï¸ **å®šä½ä¸åŒ** |
| **ETFæ•°æ®** | âœ… `get_etf_data()` | âŒ æ—  | âŒ **åŠŸèƒ½ç¼ºå¤±** |
| **Betaç³»æ•°** | âœ… `get_beta_coefficient()` | âŒ æ—  | âŒ **åŠŸèƒ½ç¼ºå¤±** |
| **52å‘¨é«˜ä½ä½** | âœ… `get_52week_high_low()` | âŒ æ—  | âŒ **åŠŸèƒ½ç¼ºå¤±** |
| **èµ„é‡‘æµå‘** | âœ… å¤šçº§é™çº§ï¼ˆ4çº§ï¼‰ | âœ… ç®€åŒ–ç‰ˆï¼ˆä¸»è¦åœ¨data_source_managerï¼‰ | âš ï¸ **é™çº§ç­–ç•¥ç®€åŒ–** |
| **æ¿å—èµ„é‡‘æµå‘** | âœ… `get_sector_fund_flow()` | âŒ æ—  | âŒ **åŠŸèƒ½ç¼ºå¤±** |
| **ç ”æŠ¥æ•°æ®** | âŒ æ—  | âœ… `get_research_reports_data()` | âœ… **æ–°å¢åŠŸèƒ½** |
| **å…¬å‘Šæ•°æ®** | âŒ æ—  | âœ… `get_announcement_data()` | âœ… **æ–°å¢åŠŸèƒ½** |
| **ç­¹ç åˆ†å¸ƒ** | âŒ æ—  | âœ… `get_chip_distribution_data()` | âœ… **æ–°å¢åŠŸèƒ½** |
| **ç½‘ç»œä¼˜åŒ–** | `network_optimizer._make_request_with_retry()` | `network_optimizer.apply()` | âœ… **æ›´ç®€æ´** |

---

### ğŸ”§ è¯¦ç»†åŠŸèƒ½å·®å¼‚

#### 1. ETFæ•°æ®è·å–

**æ—§ç‰ˆå®ç°**ï¼ˆå®Œæ•´ï¼‰:
```python
def get_etf_data(self, symbol: str, start_date: str = None, end_date: str = None) -> pd.DataFrame:
    """è·å–ETFæ•°æ®"""
    # 1. ä¼˜å…ˆä½¿ç”¨Tushare fund_dailyæ¥å£
    # 2. å¤‡é€‰ä½¿ç”¨Akshare fund_etf_hist_sina
    # æ”¯æŒè‡ªåŠ¨è¯†åˆ«å¸‚åœºå‰ç¼€ï¼ˆsh/szï¼‰
```

**ç°æœ‰å®ç°**:
```python
# âŒ æœªå®ç°
# åŠŸèƒ½å·²ç§»é™¤æˆ–æœªè¿ç§»
```

**å½±å“**:
- âŒ ç°æœ‰ç‰ˆæœ¬ä¸æ”¯æŒETFæ•°æ®è·å–
- âš ï¸ å¦‚æœç³»ç»Ÿéœ€è¦ETFåŠŸèƒ½ï¼Œéœ€è¦ä»æ—§ç‰ˆæ¢å¤

---

#### 2. Betaç³»æ•°è®¡ç®—

**æ—§ç‰ˆå®ç°**ï¼ˆå®Œæ•´ï¼‰:
```python
def get_beta_coefficient(self, symbol: str, index_code: str = '000300.SH', days: int = 250) -> float:
    """è®¡ç®—è‚¡ç¥¨Betaç³»æ•°"""
    # 1. è·å–è‚¡ç¥¨æ—¥çº¿æ•°æ®ï¼ˆTushareï¼‰
    # 2. è·å–æŒ‡æ•°æ—¥çº¿æ•°æ®ï¼ˆTushareï¼‰
    # 3. è®¡ç®—åæ–¹å·®å’Œæ–¹å·®
    # 4. è¿”å›Beta = covariance / variance
```

**ç°æœ‰å®ç°**:
```python
# âŒ æœªå®ç°
```

**å½±å“**:
- âŒ ç°æœ‰ç‰ˆæœ¬ä¸æ”¯æŒBetaç³»æ•°è®¡ç®—
- âš ï¸ å¦‚æœéœ€è¦é£é™©åˆ†æåŠŸèƒ½ï¼Œéœ€è¦ä»æ—§ç‰ˆæ¢å¤

---

#### 3. 52å‘¨é«˜ä½ä½

**æ—§ç‰ˆå®ç°**ï¼ˆå®Œæ•´ï¼‰:
```python
def get_52week_high_low(self, symbol: str) -> Dict[str, Any]:
    """è·å–52å‘¨é«˜ä½ä½æ•°æ®"""
    # 1. è·å–è¿‡å»52å‘¨ï¼ˆ365å¤©ï¼‰çš„æ—¥çº¿æ•°æ®
    # 2. è®¡ç®—æœ€é«˜ä»·ã€æœ€ä½ä»·
    # 3. æ‰¾åˆ°é«˜ä½ä½æ—¥æœŸ
    # 4. è®¡ç®—å½“å‰ä»·æ ¼åœ¨52å‘¨åŒºé—´çš„ä½ç½®ï¼ˆ0-100%ï¼‰
    return {
        'high_52w': ...,
        'low_52w': ...,
        'high_date': ...,
        'low_date': ...,
        'current_price': ...,
        'position_percent': ...  # å½“å‰ä»·æ ¼åœ¨åŒºé—´çš„ä½ç½®
    }
```

**ç°æœ‰å®ç°**:
```python
# âŒ æœªå®ç°
```

**å½±å“**:
- âŒ ç°æœ‰ç‰ˆæœ¬ä¸æ”¯æŒ52å‘¨é«˜ä½ä½åˆ†æ
- âš ï¸ å¦‚æœéœ€è¦æŠ€æœ¯åˆ†æåŠŸèƒ½ï¼Œéœ€è¦ä»æ—§ç‰ˆæ¢å¤

---

#### 4. èµ„é‡‘æµå‘æ•°æ®è·å–

**æ—§ç‰ˆæ–¹å¼**ï¼ˆ4çº§é™çº§ï¼‰:
```python
# 1. moneyflow_thsï¼ˆåŒèŠ±é¡ºæ·±åº¦èµ„é‡‘æ•°æ®ï¼Œä¼˜å…ˆï¼‰
# 2. moneyflow_dcï¼ˆä¸œè´¢ç‰ˆèµ„é‡‘æµå‘ï¼Œå•æ¬¡6000æ¡ï¼‰
# 3. moneyflowï¼ˆæ ‡å‡†èµ„é‡‘æµå‘æ•°æ®ï¼‰
# 4. Akshareï¼ˆæœ€åå¤‡é€‰ï¼‰
```

**ç°æœ‰æ–¹å¼**ï¼ˆä¸»è¦åœ¨data_source_managerï¼‰:
```python
# ä¸»è¦é€šè¿‡data_source_managerè·å–
# é™çº§ç­–ç•¥å¯èƒ½ç®€åŒ–
```

**å·®å¼‚**:
- âš ï¸ æ—§ç‰ˆæœ‰æ›´è¯¦ç»†çš„å¤šçº§é™çº§ç­–ç•¥
- âœ… ç°æœ‰ç‰ˆæœ¬å¯èƒ½åœ¨data_source_managerä¸­æœ‰ç±»ä¼¼å®ç°
- âš ï¸ éœ€è¦æ£€æŸ¥ç°æœ‰ç‰ˆæœ¬æ˜¯å¦ä¿ç•™äº†å®Œæ•´çš„é™çº§é€»è¾‘

---

#### 5. æ¿å—/è¡Œä¸šèµ„é‡‘æµå‘

**æ—§ç‰ˆå®ç°**ï¼ˆå®Œæ•´ï¼‰:
```python
def get_sector_fund_flow(self, symbol: str) -> Dict[str, Any]:
    """è·å–è‚¡ç¥¨æ‰€å±æ¿å—/è¡Œä¸šçš„èµ„é‡‘æµå‘æ•°æ®"""
    # 1. è·å–è‚¡ç¥¨æ‰€å±è¡Œä¸šï¼ˆstock_basicï¼‰
    # 2. è·å–è¡Œä¸šèµ„é‡‘æµå‘ï¼ˆmoneyflow_ind_thsï¼‰
    # 3. è·å–æ¿å—èµ„é‡‘æµå‘ï¼ˆmoneyflow_cnt_thsï¼‰
    # 4. è¿”å›è¡Œä¸šå’Œæ¿å—æ•°æ®
```

**ç°æœ‰å®ç°**:
```python
# âŒ æœªå®ç°
```

**å½±å“**:
- âŒ ç°æœ‰ç‰ˆæœ¬ä¸æ”¯æŒæ¿å—èµ„é‡‘æµå‘åˆ†æ
- âš ï¸ å¦‚æœéœ€è¦è¡Œä¸š/æ¿å—åˆ†æåŠŸèƒ½ï¼Œéœ€è¦ä»æ—§ç‰ˆæ¢å¤

---

#### 6. æ²ªæ·±æ¸¯é€šèµ„é‡‘æµå‘

**æ—§ç‰ˆæ–¹å¼**:
```python
def get_hsgt_capital_flow(self, symbol: str = None, trade_date: str = None) -> Dict[str, Any]:
    """è·å–æ²ªæ·±æ¸¯é€šèµ„é‡‘æµå‘æ•°æ®ï¼ˆåŒ—å‘/å—å‘èµ„é‡‘ï¼‰"""
    # ä½¿ç”¨Tushare hsgt_top10æ¥å£
    # æ”¯æŒæœ€è¿‘10ä¸ªäº¤æ˜“æ—¥å›é€€
    # è¿”å›Top10æ•°æ®
```

**ç°æœ‰æ–¹å¼**ï¼ˆåœ¨data_source_managerï¼‰:
```python
# åœ¨data_source_managerä¸­å®ç°
# get_hsgt_fund_flow_data()
```

**å·®å¼‚**:
- âœ… åŠŸèƒ½å·²è¿ç§»åˆ°data_source_manager
- âš ï¸ æ¥å£åç§°å’Œè¿”å›å€¼ç»“æ„å¯èƒ½ä¸åŒ

---

#### 7. ç ”æŠ¥æ•°æ®è·å–ï¼ˆæ–°å¢ï¼‰

**æ—§ç‰ˆ**: âŒ æ— 

**ç°æœ‰**: âœ… æœ‰å®ç°ï¼ˆä½†ç®€åŒ–ç‰ˆï¼‰
```python
def get_research_reports_data(self, symbol: str, days: int = 30) -> Dict[str, Any]:
    """è·å–æœºæ„ç ”æŠ¥æ•°æ® (akshareå®ç°)"""
    # ä½¿ç”¨Akshare stock_research_report_em
    # è¿”å›ç ”æŠ¥åˆ—è¡¨
```

**è¯´æ˜**:
- âœ… ç°æœ‰ç‰ˆæœ¬æ–°å¢äº†ç ”æŠ¥æ•°æ®åŠŸèƒ½
- âš ï¸ ä½†å®ç°è¾ƒæ—§ç‰ˆdata_source_managerä¸­çš„ç ”æŠ¥åˆ†æåŠŸèƒ½ç®€åŒ–ï¼ˆç¼ºå°‘ç»Ÿè®¡åˆ†æï¼‰

---

#### 8. å…¬å‘Šæ•°æ®è·å–ï¼ˆæ–°å¢ï¼‰

**æ—§ç‰ˆ**: âŒ æ— 

**ç°æœ‰**: âœ… æœ‰å®ç°
```python
def get_announcement_data(self, symbol: str, days: int = 30) -> Dict[str, Any]:
    """è·å–å…¬å‘Šæ•°æ® - è¿‡å»Nå¤©çš„ä¸Šå¸‚å…¬å¸å…¬å‘Š (Tushareä¼˜å…ˆ)"""
    # 1. Tushare announcementæ¥å£ï¼ˆä¼˜å…ˆï¼‰
    # 2. é—®è´¢ï¼ˆpywencaiï¼‰å¤‡ç”¨
    # 3. Akshare stock_news_emï¼ˆé™çº§ï¼‰
    # åŒ…å«å…¬å‘Šé“¾æ¥æ„å»º
```

**è¯´æ˜**:
- âœ… ç°æœ‰ç‰ˆæœ¬æ–°å¢äº†å…¬å‘Šæ•°æ®åŠŸèƒ½
- âœ… æ”¯æŒå¤šæ•°æ®æºé™çº§
- âœ… è‡ªåŠ¨æ„å»ºå…¬å‘Šä¸‹è½½é“¾æ¥

---

#### 9. ç­¹ç åˆ†å¸ƒæ•°æ®è·å–ï¼ˆæ–°å¢ï¼‰

**æ—§ç‰ˆ**: âŒ æ— 

**ç°æœ‰**: âœ… æœ‰å®ç°
```python
def get_chip_distribution_data(self, symbol: str) -> Dict[str, Any]:
    """è·å–ç­¹ç åˆ†å¸ƒæ•°æ®ï¼ˆTushare cyq_perfå’Œcyq_chipsæ¥å£ï¼‰"""
    # ä½¿ç”¨Tushare cyq_perfï¼ˆæ¯æ—¥ç­¹ç åŠèƒœç‡ï¼‰
    # ä½¿ç”¨Tushare cyq_chipsï¼ˆæ¯æ—¥ç­¹ç åˆ†å¸ƒï¼‰
    # åŒ…å«æ•°æ®æ‘˜è¦ï¼ˆé›†ä¸­åº¦ã€å¹³å‡æˆæœ¬ã€æˆæœ¬åŒºé—´ï¼‰
```

**è¯´æ˜**:
- âœ… ç°æœ‰ç‰ˆæœ¬æ–°å¢äº†ç­¹ç åˆ†å¸ƒæ•°æ®åŠŸèƒ½
- âœ… ä½¿ç”¨Tushareä¸“ç”¨æ¥å£

---

## 3. ç½‘ç»œä¼˜åŒ–æ–¹å¼å¯¹æ¯”

### æ—§ç‰ˆç½‘ç»œä¼˜åŒ–

**æ–¹å¼1**: æ‰‹åŠ¨æ¸…é™¤ä»£ç†ç¯å¢ƒå˜é‡
```python
# data_source_manager_old.py
old_http_proxy = os.environ.get('HTTP_PROXY')
if 'HTTP_PROXY' in os.environ:
    del os.environ['HTTP_PROXY']
# ... Tushareè°ƒç”¨ ...
if old_http_proxy:
    os.environ['HTTP_PROXY'] = old_http_proxy
```

**æ–¹å¼2**: ä½¿ç”¨standard_network_api
```python
# data_source_manager_old.py
from standard_network_api import get_akshare_data
df = get_akshare_data('stock_zh_a_hist', ...)
```

**æ–¹å¼3**: ä½¿ç”¨network_optimizer._make_request_with_retry
```python
# unified_data_api_old.py
from network_optimizer import network_optimizer
def _akshare_call(**kwargs):
    return func(**kwargs)
df = network_optimizer._make_request_with_retry(_akshare_call)
```

### ç°æœ‰ç½‘ç»œä¼˜åŒ–

**ç»Ÿä¸€æ–¹å¼**: ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
```python
# data_source_manager.py å’Œ unified_data_access.py
with network_optimizer.apply():
    # Tushareæˆ–Akshareè°ƒç”¨
    df = self.tushare_api.daily(...)
    # æˆ–
    df = ak.stock_zh_a_hist(...)
```

**ä¼˜åŠ¿**:
- âœ… ä»£ç æ›´ç®€æ´ç»Ÿä¸€
- âœ… è‡ªåŠ¨èµ„æºç®¡ç†
- âœ… å‡å°‘é—æ¼ä»£ç†æ¢å¤çš„é£é™©
- âœ… ç»Ÿä¸€çš„ç½‘ç»œä¼˜åŒ–ç­–ç•¥

---

## 4. åŠŸèƒ½è¿ç§»æ€»ç»“

### âœ… å·²ä¿ç•™åŠŸèƒ½

| åŠŸèƒ½ | æ—§ç‰ˆä½ç½® | ç°æœ‰ä½ç½® | çŠ¶æ€ |
|------|---------|---------|------|
| è‚¡ç¥¨å†å²æ•°æ® | data_source_manager_old | data_source_manager | âœ… ä¿ç•™ |
| è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯ | data_source_manager_old | data_source_manager | âœ… ä¿ç•™ |
| å®æ—¶è¡Œæƒ… | data_source_manager_old | data_source_manager | âœ… ä¿ç•™ |
| è´¢åŠ¡æ•°æ® | data_source_manager_old | data_source_manager | âœ… ä¿ç•™ |
| èèµ„èåˆ¸ | data_source_manager_old | data_source_manager | âœ… ä¿ç•™ |
| æ²ªæ·±æ¸¯é€š | data_source_manager_old | data_source_manager | âœ… ä¿ç•™ |

### âŒ å·²ç§»é™¤åŠŸèƒ½

| åŠŸèƒ½ | æ—§ç‰ˆä½ç½® | ç°æœ‰ä½ç½® | å½±å“ |
|------|---------|---------|------|
| ETFæ•°æ® | unified_data_api_old | âŒ æ—  | âš ï¸ é«˜çº§åŠŸèƒ½ç¼ºå¤± |
| Betaç³»æ•°è®¡ç®— | unified_data_api_old | âŒ æ—  | âš ï¸ é£é™©åˆ†æåŠŸèƒ½ç¼ºå¤± |
| 52å‘¨é«˜ä½ä½ | unified_data_api_old | âŒ æ—  | âš ï¸ æŠ€æœ¯åˆ†æåŠŸèƒ½ç¼ºå¤± |
| æ¿å—èµ„é‡‘æµå‘ | unified_data_api_old | âŒ æ—  | âš ï¸ è¡Œä¸šåˆ†æåŠŸèƒ½ç¼ºå¤± |
| ç ”æŠ¥ç»Ÿè®¡åˆ†æ | data_source_manager_old | âš ï¸ ç®€åŒ–ç‰ˆ | âš ï¸ åŠŸèƒ½ç®€åŒ– |

### âœ… æ–°å¢åŠŸèƒ½

| åŠŸèƒ½ | æ—§ç‰ˆä½ç½® | ç°æœ‰ä½ç½® | è¯´æ˜ |
|------|---------|---------|------|
| ç ”æŠ¥æ•°æ®è·å– | âŒ æ—  | unified_data_access | âœ… æ–°å¢ï¼ˆç®€åŒ–ç‰ˆï¼‰ |
| å…¬å‘Šæ•°æ®è·å– | âŒ æ—  | unified_data_access | âœ… æ–°å¢ï¼ˆå®Œæ•´ç‰ˆï¼‰ |
| ç­¹ç åˆ†å¸ƒæ•°æ® | âŒ æ—  | unified_data_access | âœ… æ–°å¢ï¼ˆå®Œæ•´ç‰ˆï¼‰ |

---

## 5. ä»£ç è´¨é‡å¯¹æ¯”

### æ—§ç‰ˆç‰¹ç‚¹

**ä¼˜åŠ¿**:
- âœ… åŠŸèƒ½å®Œæ•´ï¼ˆETFã€Betaã€52å‘¨ç­‰é«˜çº§åŠŸèƒ½ï¼‰
- âœ… è¯¦ç»†çš„å¤šçº§é™çº§ç­–ç•¥
- âœ… å®Œæ•´çš„ç ”æŠ¥ç»Ÿè®¡åˆ†æ

**åŠ£åŠ¿**:
- âŒ ä»£ç å†—é•¿ï¼ˆ1767è¡Œ + 1122è¡Œ = 2889è¡Œï¼‰
- âŒ æ‰‹åŠ¨ç®¡ç†ä»£ç†ç¯å¢ƒå˜é‡ï¼Œå®¹æ˜“å‡ºé”™
- âŒ ä½¿ç”¨å¤šç§ä¸åŒçš„ç½‘ç»œä¼˜åŒ–æ–¹å¼ï¼Œä¸ç»Ÿä¸€

### ç°æœ‰ç‰¹ç‚¹

**ä¼˜åŠ¿**:
- âœ… ä»£ç ç²¾ç®€ï¼ˆ367è¡Œ + 1041è¡Œ = 1408è¡Œï¼Œå‡å°‘51%ï¼‰
- âœ… ç»Ÿä¸€çš„ç½‘ç»œä¼˜åŒ–æ–¹å¼ï¼ˆ`network_optimizer.apply()`ï¼‰
- âœ… è‡ªåŠ¨èµ„æºç®¡ç†ï¼Œå‡å°‘é”™è¯¯é£é™©
- âœ… æ–°å¢äº†å…¬å‘Šå’Œç­¹ç åˆ†å¸ƒåŠŸèƒ½

**åŠ£åŠ¿**:
- âŒ ç§»é™¤äº†ETFã€Betaã€52å‘¨ç­‰é«˜çº§åŠŸèƒ½
- âŒ ç ”æŠ¥åŠŸèƒ½ç®€åŒ–ï¼Œç¼ºå°‘ç»Ÿè®¡åˆ†æ
- âŒ èµ„é‡‘æµå‘é™çº§ç­–ç•¥å¯èƒ½ç®€åŒ–

---

## 6. å»ºè®®çš„æ”¹è¿›æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šæ¢å¤é«˜çº§åŠŸèƒ½ï¼ˆæ¨èï¼‰

**ä¼˜å…ˆçº§ï¼šé«˜**

1. **æ¢å¤ETFæ•°æ®è·å–**
   - ä» `unified_data_api_old.py` è¿ç§» `get_etf_data()` æ–¹æ³•
   - ä½¿ç”¨ç°æœ‰çš„ `network_optimizer.apply()` æ–¹å¼

2. **æ¢å¤Betaç³»æ•°è®¡ç®—**
   - ä» `unified_data_api_old.py` è¿ç§» `get_beta_coefficient()` æ–¹æ³•
   - å¯ç”¨äºé£é™©è¯„ä¼°åˆ†æ

3. **æ¢å¤52å‘¨é«˜ä½ä½**
   - ä» `unified_data_api_old.py` è¿ç§» `get_52week_high_low()` æ–¹æ³•
   - å¯ç”¨äºæŠ€æœ¯åˆ†æ

4. **æ¢å¤æ¿å—èµ„é‡‘æµå‘**
   - ä» `unified_data_api_old.py` è¿ç§» `get_sector_fund_flow()` æ–¹æ³•
   - å¯ç”¨äºè¡Œä¸šåˆ†æ

### æ–¹æ¡ˆ2ï¼šå¢å¼ºç ”æŠ¥åŠŸèƒ½

**ä¼˜å…ˆçº§ï¼šä¸­**

1. **å¢å¼ºç ”æŠ¥ç»Ÿè®¡åˆ†æ**
   - ä» `data_source_manager_old.py` çš„ `_analyze_research_reports()` æ–¹æ³•å­¦ä¹ 
   - æ·»åŠ è¯„çº§åˆ†å¸ƒç»Ÿè®¡ï¼ˆä¹°å…¥/ä¸­æ€§/å–å‡ºæ¯”ä¾‹ï¼‰
   - æ·»åŠ ç›®æ ‡ä»·æ ¼ç»Ÿè®¡
   - æ·»åŠ æœºæ„ç»Ÿè®¡

2. **æ·»åŠ Tushareç ”æŠ¥æ¥å£æ”¯æŒ**
   - æ—§ç‰ˆä½¿ç”¨ `report_rc` æ¥å£
   - å¦‚æœTushareæœ‰è¯¥æ¥å£ï¼Œä¼˜å…ˆä½¿ç”¨

### æ–¹æ¡ˆ3ï¼šä»£ç é‡æ„ä¼˜åŒ–

**ä¼˜å…ˆçº§ï¼šä½**

1. **ç»Ÿä¸€æ¥å£å‘½å**
   - æ£€æŸ¥å¹¶ç»Ÿä¸€data_source_managerå’Œunified_data_accessçš„æ¥å£å‘½å
   - ç¡®ä¿è¿”å›å€¼ç»“æ„ä¸€è‡´

2. **å¢å¼ºé”™è¯¯å¤„ç†**
   - æ·»åŠ æ›´è¯¦ç»†çš„ç±»å‹æ£€æŸ¥ï¼ˆå‚è€ƒç°æœ‰ç‰ˆæœ¬çš„dict/DataFrameæ£€æŸ¥ï¼‰
   - æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼ˆå‚è€ƒç°æœ‰çš„debug_loggerï¼‰

---

## 7. æ€»ç»“

### ä¸»è¦å‘ç°

1. **ä»£ç è´¨é‡æå‡**
   - âœ… ç°æœ‰ç‰ˆæœ¬ä»£ç ç²¾ç®€51%ï¼ˆ2889è¡Œ â†’ 1408è¡Œï¼‰
   - âœ… ç»Ÿä¸€çš„ç½‘ç»œä¼˜åŒ–æ–¹å¼ï¼Œæ›´æ˜“ç»´æŠ¤
   - âœ… è‡ªåŠ¨èµ„æºç®¡ç†ï¼Œå‡å°‘é”™è¯¯é£é™©

2. **åŠŸèƒ½ç¼ºå¤±**
   - âŒ ç§»é™¤äº†ETFã€Betaã€52å‘¨ã€æ¿å—èµ„é‡‘æµå‘ç­‰é«˜çº§åŠŸèƒ½
   - âš ï¸ ç ”æŠ¥åŠŸèƒ½ç®€åŒ–ï¼Œç¼ºå°‘ç»Ÿè®¡åˆ†æ

3. **åŠŸèƒ½æ–°å¢**
   - âœ… æ–°å¢äº†å…¬å‘Šå’Œç­¹ç åˆ†å¸ƒåŠŸèƒ½
   - âœ… åŠŸèƒ½æ›´ç¬¦åˆå½“å‰ä¸šåŠ¡éœ€æ±‚

### å»ºè®®

1. **ä¼˜å…ˆæ¢å¤é«˜çº§åŠŸèƒ½**
   - ETFæ•°æ®ã€Betaç³»æ•°ã€52å‘¨é«˜ä½ä½æ˜¯å¸¸ç”¨çš„åˆ†æå·¥å…·
   - æ¿å—èµ„é‡‘æµå‘å¯¹è¡Œä¸šåˆ†æå¾ˆé‡è¦

2. **å¢å¼ºç ”æŠ¥åŠŸèƒ½**
   - å‚è€ƒæ—§ç‰ˆçš„ç»Ÿè®¡åˆ†æé€»è¾‘
   - è¡¥å……è¯„çº§åˆ†å¸ƒã€ç›®æ ‡ä»·æ ¼ç­‰ç»Ÿè®¡

3. **ä¿æŒä»£ç ç®€æ´**
   - åœ¨æ¢å¤åŠŸèƒ½æ—¶ï¼Œä½¿ç”¨ç°æœ‰çš„ `network_optimizer.apply()` æ–¹å¼
   - é¿å…å¼•å…¥æ—§ç‰ˆçš„æ‰‹åŠ¨ä»£ç†ç®¡ç†ä»£ç 

---

**åˆ†ææ—¶é—´**: 2025-11-02  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**å¯¹æ¯”æ–‡ä»¶**: 
- newdoc/data_source_manager_old.py (1767è¡Œ)
- newdoc/unified_data_api_old.py (1122è¡Œ)
- data_source_manager.py (çº¦367è¡Œ)
- unified_data_access.py (çº¦1041è¡Œ)

