# å¸‚åœºæƒ…ç»ªæ•°æ®Tushareä¼˜å…ˆæ”¹é€ æ€»ç»“

## ğŸ¯ æ”¹é€ ç›®æ ‡

å°†å¸‚åœºæƒ…ç»ªæ•°æ®è·å–æ”¹ä¸ºä¼˜å…ˆä½¿ç”¨**Tushareæ•°æ®æº**ï¼Œè§£å†³Akshareç½‘ç»œè¿æ¥é—®é¢˜ï¼ˆConnection abortedï¼‰ã€‚

---

## ğŸ› åŸé—®é¢˜

### é”™è¯¯ä¿¡æ¯
```
[Akshare] âŒ è·å–æ¢æ‰‹ç‡å¤±è´¥: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))
[Akshare] âŒ è·å–å¤§ç›˜æŒ‡æ•°å¤±è´¥: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))
```

### é—®é¢˜åŸå› 
- åŸä»£ç ä¼˜å…ˆä½¿ç”¨Akshareè·å–æ•°æ®
- Akshareç½‘ç»œè¿æ¥ä¸ç¨³å®šï¼Œå®¹æ˜“å‡ºç°è¿æ¥ä¸­æ–­
- Tushareæ›´ç¨³å®šå¯é ï¼Œä½†æ²¡æœ‰ä¼˜å…ˆä½¿ç”¨

---

## âœ… æ”¹é€ å†…å®¹

### 1. `_get_turnover_rate()` æ–¹æ³•

**ä¿®æ”¹ä½ç½®**: `market_sentiment_data.py` ç¬¬ 332 è¡Œ

**æ”¹é€ å‰**:
- âŒ ä¼˜å…ˆä½¿ç”¨Akshare (`ak.stock_zh_a_spot_em()`)
- âŒ Akshareå¤±è´¥åæ‰å°è¯•Tushare

**æ”¹é€ å**:
- âœ… **ä¼˜å…ˆä½¿ç”¨Tushare** (`tushare_api.daily_basic()`)
- âœ… Tushareå¤±è´¥åæ‰ä½¿ç”¨Akshareä½œä¸ºå¤‡ç”¨
- âœ… å¢åŠ äº¤æ˜“æ—¥å›æº¯é€»è¾‘ï¼ˆæœ€å¤šå›æº¯5å¤©ï¼Œå¤„ç†éäº¤æ˜“æ—¥æƒ…å†µï¼‰
- âœ… ç»Ÿä¸€çš„æ¢æ‰‹ç‡è§£è¯»å‡½æ•°
- âœ… è¿”å›ç»“æœåŒ…å«æ•°æ®æºæ ‡è¯† (`source: "tushare"` æˆ– `"akshare"`)

**ä»£ç é€»è¾‘**:
```python
# 1. ä¼˜å…ˆTushare
if data_source_manager.tushare_available:
    # å°è¯•æœ€è¿‘5ä¸ªäº¤æ˜“æ—¥
    for days_back in range(5):
        trade_date = (datetime.now() - timedelta(days=days_back)).strftime('%Y%m%d')
        df = tushare_api.daily_basic(ts_code=ts_code, trade_date=trade_date)
        if df is not None and not df.empty:
            return result_with_source("tushare")

# 2. Tushareå¤±è´¥ï¼Œä½¿ç”¨Akshareå¤‡ç”¨
try:
    df = ak.stock_zh_a_spot_em()
    # ...å¤„ç†Akshareæ•°æ®...
    return result_with_source("akshare")
except:
    return None
```

---

### 2. `_get_market_index_sentiment()` æ–¹æ³•

**ä¿®æ”¹ä½ç½®**: `market_sentiment_data.py` ç¬¬ 412 è¡Œ

**æ”¹é€ å‰**:
- âŒ ä¼˜å…ˆä½¿ç”¨Akshare (`ak.stock_zh_index_spot_em()`)
- âŒ Akshareå¤±è´¥åæ‰å°è¯•Tushare

**æ”¹é€ å**:
- âœ… **ä¼˜å…ˆä½¿ç”¨Tushare** (`tushare_api.index_daily()`)
- âœ… Tushareå¤±è´¥åæ‰ä½¿ç”¨Akshareä½œä¸ºå¤‡ç”¨
- âœ… å¢åŠ äº¤æ˜“æ—¥å›æº¯é€»è¾‘ï¼ˆæœ€å¤šå›æº¯5å¤©ï¼‰
- âœ… è¿”å›ç»“æœåŒ…å«æ•°æ®æºæ ‡è¯†

**ä»£ç é€»è¾‘**:
```python
# 1. ä¼˜å…ˆTushare
if data_source_manager.tushare_available:
    # å°è¯•æœ€è¿‘5ä¸ªäº¤æ˜“æ—¥
    for days_back in range(5):
        trade_date = (datetime.now() - timedelta(days=days_back)).strftime('%Y%m%d')
        df = tushare_api.index_daily(ts_code='000001.SH', start_date=trade_date, end_date=trade_date)
        if df is not None and not df.empty:
            return result_with_source("tushare")

# 2. Tushareå¤±è´¥ï¼Œä½¿ç”¨Akshareå¤‡ç”¨
try:
    df = ak.stock_zh_index_spot_em(symbol="ä¸Šè¯ç³»åˆ—æŒ‡æ•°")
    # ...å¤„ç†Akshareæ•°æ®ï¼ˆåŒ…æ‹¬æ¶¨è·Œå®¶æ•°ï¼‰...
    return result_with_source("akshare")
except:
    return None
```

---

## ğŸ“Š æ•°æ®æµç¨‹å¯¹æ¯”

### æ”¹é€ å‰ï¼ˆAkshareä¼˜å…ˆï¼‰
```
ç”¨æˆ·è¯·æ±‚
    â†“
[Akshare] å°è¯•è·å–æ•°æ®
    â”œâ”€ æˆåŠŸ â†’ è¿”å›ç»“æœ
    â””â”€ å¤±è´¥ â†’ [Tushare] å°è¯•è·å–æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
                â”œâ”€ æˆåŠŸ â†’ è¿”å›ç»“æœ
                â””â”€ å¤±è´¥ â†’ è¿”å›None
```

### æ”¹é€ åï¼ˆTushareä¼˜å…ˆï¼‰
```
ç”¨æˆ·è¯·æ±‚
    â†“
[Tushare] å°è¯•è·å–æ•°æ®ï¼ˆä¼˜å…ˆï¼‰
    â”œâ”€ æˆåŠŸ â†’ è¿”å›ç»“æœ (source: "tushare")
    â””â”€ å¤±è´¥ â†’ [Akshare] å°è¯•è·å–æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
                â”œâ”€ æˆåŠŸ â†’ è¿”å›ç»“æœ (source: "akshare")
                â””â”€ å¤±è´¥ â†’ è¿”å›None
```

---

## ğŸ” å…³é”®æ”¹è¿›

### 1. æ•°æ®æºä¼˜å…ˆçº§è°ƒæ•´
- **æ”¹é€ å‰**: Akshare â†’ Tushare
- **æ”¹é€ å**: Tushare â†’ Akshare âœ…

### 2. äº¤æ˜“æ—¥å¤„ç†
æ–°å¢äº¤æ˜“æ—¥å›æº¯é€»è¾‘ï¼Œå¤„ç†éäº¤æ˜“æ—¥æƒ…å†µï¼š
```python
# å°è¯•æœ€è¿‘5ä¸ªäº¤æ˜“æ—¥çš„æ•°æ®
for days_back in range(5):
    trade_date = (datetime.now() - timedelta(days=days_back)).strftime('%Y%m%d')
    # å°è¯•è·å–è¯¥äº¤æ˜“æ—¥æ•°æ®
```

### 3. æ•°æ®æºæ ‡è¯†
è¿”å›ç»“æœåŒ…å«æ•°æ®æºä¿¡æ¯ï¼Œä¾¿äºè¿½è¸ªï¼š
```python
return {
    "current_turnover_rate": turnover_rate,
    "interpretation": interpretation,
    "source": "tushare"  # æˆ– "akshare"
}
```

### 4. ä»£ç ä¼˜åŒ–
- ç»Ÿä¸€çš„æ¢æ‰‹ç‡è§£è¯»å‡½æ•°
- å‡å°‘ä»£ç é‡å¤
- æ›´å¥½çš„é”™è¯¯å¤„ç†

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### `market_sentiment_data.py`

#### ä¿®æ”¹1: æ–‡ä»¶æ³¨é‡Š
```python
# æ”¹é€ å‰
"""
ä½¿ç”¨akshareè·å–å¸‚åœºæƒ…ç»ªç›¸å…³æŒ‡æ ‡...
"""

# æ”¹é€ å
"""
ä¼˜å…ˆä½¿ç”¨Tushareè·å–å¸‚åœºæƒ…ç»ªç›¸å…³æŒ‡æ ‡ï¼Œå¤±è´¥åˆ™ä½¿ç”¨Akshareä½œä¸ºå¤‡ç”¨
"""
```

#### ä¿®æ”¹2: `_get_turnover_rate()` æ–¹æ³•
- âœ… ä¼˜å…ˆä½¿ç”¨Tushare
- âœ… äº¤æ˜“æ—¥å›æº¯é€»è¾‘
- âœ… ç»Ÿä¸€è§£è¯»å‡½æ•°
- âœ… æ•°æ®æºæ ‡è¯†
- **ä»£ç è¡Œæ•°**: åŸ~80è¡Œ â†’ ç°~78è¡Œ

#### ä¿®æ”¹3: `_get_market_index_sentiment()` æ–¹æ³•
- âœ… ä¼˜å…ˆä½¿ç”¨Tushare
- âœ… äº¤æ˜“æ—¥å›æº¯é€»è¾‘
- âœ… æ•°æ®æºæ ‡è¯†
- **ä»£ç è¡Œæ•°**: åŸ~85è¡Œ â†’ ç°~95è¡Œ

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### 1. æé«˜æ•°æ®è·å–æˆåŠŸç‡
- âœ… Tushareæ›´ç¨³å®šï¼Œå‡å°‘è¿æ¥ä¸­æ–­
- âœ… é¿å…ç½‘ç»œä»£ç†é—®é¢˜
- âœ… æé«˜ç”¨æˆ·ä½“éªŒ

### 2. æ›´å¥½çš„é”™è¯¯å¤„ç†
- âœ… è‡ªåŠ¨å›æº¯äº¤æ˜“æ—¥
- âœ… å¤šå±‚é™çº§ç­–ç•¥
- âœ… æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

### 3. å¯è¿½è¸ªæ€§
- âœ… è¿”å›æ•°æ®åŒ…å«æ¥æºæ ‡è¯†
- âœ… ä¾¿äºåˆ†ææ•°æ®è´¨é‡
- âœ… ä¾¿äºæ€§èƒ½ä¼˜åŒ–

---

## ğŸ“Š æ—¥å¿—è¾“å‡ºç¤ºä¾‹

### æ­£å¸¸æƒ…å†µï¼ˆTushareæˆåŠŸï¼‰
```
[Tushare] æ­£åœ¨è·å–æ¢æ‰‹ç‡æ•°æ®...
[Tushare] âœ… æˆåŠŸè·å–æ¢æ‰‹ç‡: 3.45%
```

### Tushareå¤±è´¥ï¼ŒAkshareæˆåŠŸ
```
[Tushare] æ­£åœ¨è·å–æ¢æ‰‹ç‡æ•°æ®...
[Tushare] âŒ è·å–å¤±è´¥: ...
[Akshare] æ­£åœ¨è·å–æ¢æ‰‹ç‡æ•°æ®ï¼ˆå¤‡ç”¨æ•°æ®æºï¼‰...
[Akshare] âœ… æˆåŠŸè·å–æ¢æ‰‹ç‡: 3.45%
```

### éäº¤æ˜“æ—¥å¤„ç†
```
[Tushare] æ­£åœ¨è·å–æ¢æ‰‹ç‡æ•°æ®...
[å°è¯• trade_date=20251101] - æ— æ•°æ®
[å°è¯• trade_date=20251031] - æ— æ•°æ®
[å°è¯• trade_date=20251030] - âœ… æˆåŠŸè·å–
[Tushare] âœ… æˆåŠŸè·å–æ¢æ‰‹ç‡: 3.45%
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### 1. Tushare APIè°ƒç”¨

#### æ¢æ‰‹ç‡æ•°æ®
```python
# ä½¿ç”¨ daily_basic æ¥å£
df = tushare_api.daily_basic(
    ts_code=ts_code,           # è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ '000001.SZ'ï¼‰
    trade_date=trade_date      # äº¤æ˜“æ—¥æœŸï¼ˆæ ¼å¼ï¼š'20251101'ï¼‰
)
# è¿”å›å­—æ®µ: turnover_rateï¼ˆæ¢æ‰‹ç‡ï¼‰
```

#### å¤§ç›˜æŒ‡æ•°æ•°æ®
```python
# ä½¿ç”¨ index_daily æ¥å£
df = tushare_api.index_daily(
    ts_code='000001.SH',       # ä¸Šè¯æŒ‡æ•°
    start_date=trade_date,    # å¼€å§‹æ—¥æœŸ
    end_date=trade_date       # ç»“æŸæ—¥æœŸï¼ˆåŒä¸€å¤©ï¼‰
)
# è¿”å›å­—æ®µ: pct_chgï¼ˆæ¶¨è·Œå¹…ï¼‰
```

### 2. äº¤æ˜“æ—¥å›æº¯é€»è¾‘

```python
# æœ€å¤šå›æº¯5å¤©ï¼Œæ‰¾åˆ°æœ€è¿‘çš„æœ‰æ•ˆäº¤æ˜“æ—¥
for days_back in range(5):
    trade_date = (datetime.now() - timedelta(days=days_back)).strftime('%Y%m%d')
    try:
        df = api_call(trade_date=trade_date)
        if df is not None and not df.empty:
            return df  # æ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œç«‹å³è¿”å›
    except:
        continue  # ç»§ç»­å°è¯•ä¸‹ä¸€å¤©
```

---

## âœ… éªŒæ”¶æ ‡å‡†

- [x] æ¢æ‰‹ç‡æ•°æ®ä¼˜å…ˆä½¿ç”¨Tushare âœ…
- [x] å¤§ç›˜æŒ‡æ•°æ•°æ®ä¼˜å…ˆä½¿ç”¨Tushare âœ…
- [x] Tushareå¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°Akshare âœ…
- [x] å¤„ç†éäº¤æ˜“æ—¥æƒ…å†µ âœ…
- [x] è¿”å›ç»“æœåŒ…å«æ•°æ®æºæ ‡è¯† âœ…
- [x] ä»£ç æ³¨é‡Šæ›´æ–° âœ…
- [x] ä¿æŒåŸæœ‰åŠŸèƒ½å®Œæ•´æ€§ âœ…

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. å…¶ä»–æ–¹æ³•æ”¹é€ 
æ–‡ä»¶ä¸­è¿˜æœ‰å…¶ä»–ä½¿ç”¨Akshareçš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘åŒæ ·æ”¹ä¸ºTushareä¼˜å…ˆï¼š
- `_get_limit_up_down_stats()` - æ¶¨è·Œåœç»Ÿè®¡
- `_get_margin_trading_data()` - èèµ„èåˆ¸æ•°æ®
- `_get_fear_greed_index()` - ææ…Œè´ªå©ªæŒ‡æ•°

### 2. ç»Ÿä¸€æ•°æ®è®¿é—®æ¥å£
è€ƒè™‘é€šè¿‡ `UnifiedDataAccess` ç»Ÿä¸€è·å–æ‰€æœ‰å¸‚åœºæƒ…ç»ªæ•°æ®ï¼Œè¿›ä¸€æ­¥ç»Ÿä¸€æ¥å£ã€‚

### 3. ç¼“å­˜æœºåˆ¶
å¯¹äºå¸‚åœºæƒ…ç»ªæ•°æ®ï¼Œå¯ä»¥æ·»åŠ ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘APIè°ƒç”¨ã€‚

---

## ğŸ“¦ æ”¹é€ æ€»ç»“

### æ”¹é€ èŒƒå›´
- âœ… 2ä¸ªæ ¸å¿ƒæ–¹æ³•
- âœ… æ–‡ä»¶æ³¨é‡Šæ›´æ–°
- âœ… æ•°æ®æºä¼˜å…ˆçº§è°ƒæ•´

### ä»£ç å˜æ›´
- **ä¿®æ”¹è¡Œæ•°**: ~165è¡Œ
- **æ–°å¢åŠŸèƒ½**: äº¤æ˜“æ—¥å›æº¯ã€æ•°æ®æºæ ‡è¯†
- **ä»£ç è´¨é‡**: æé«˜ï¼ˆå‡å°‘é‡å¤ã€ç»Ÿä¸€å‡½æ•°ï¼‰

### æ•ˆæœ
- âœ… æé«˜æ•°æ®è·å–æˆåŠŸç‡
- âœ… å‡å°‘ç½‘ç»œè¿æ¥é”™è¯¯
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
- âœ… ä¾¿äºè¿½è¸ªå’Œè°ƒè¯•

---

**æ”¹é€ æ—¶é—´**: 2025-11-01  
**å½±å“æ–‡ä»¶**: 1ä¸ª  
**ä¿®æ”¹æ–¹æ³•**: 2ä¸ª  
**æµ‹è¯•çŠ¶æ€**: âœ… å¾…æµ‹è¯•  
**æ”¹é€ çŠ¶æ€**: âœ… å·²å®Œæˆ

