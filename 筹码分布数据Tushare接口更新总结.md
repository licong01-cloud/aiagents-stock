# ç­¹ç åˆ†å¸ƒæ•°æ®Tushareæ¥å£æ›´æ–°æ€»ç»“

## ğŸ¯ æ›´æ–°ç›®æ ‡

æ ¹æ®ç”¨æˆ·è¦æ±‚ï¼Œå°†ç­¹ç åˆ†å¸ƒæ•°æ®è·å–æ–¹å¼æ›´æ–°ä¸ºä½¿ç”¨Tushareçš„ä¸“ä¸šæ¥å£ï¼š
1. `cyq_perf` æ¥å£ï¼šè·å–æ¯æ—¥ç­¹ç åŠèƒœç‡æ•°æ®
2. `cyq_chips` æ¥å£ï¼šè·å–æ¯æ—¥ç­¹ç åˆ†å¸ƒæ•°æ®

**å‚è€ƒæ–‡æ¡£**:
- cyq_perf: https://tushare.pro/document/2?doc_id=293
- cyq_chips: https://tushare.pro/document/2?doc_id=294

---

## âœ… æ›´æ–°å†…å®¹

### ä¿®å¤ä½ç½®
`unified_data_access.py` ç¬¬ 822-1007 è¡Œ

### ä¸»è¦æ”¹è¿›

#### 1. ä½¿ç”¨Tushareä¸“ä¸šæ¥å£

**ä¿®å¤å‰**:
- ä½¿ç”¨ `stk_holdernumber` è·å–è‚¡ä¸œäººæ•°ï¼ˆä¸å®Œæ•´ï¼‰
- ä½¿ç”¨Akshareå¤‡ç”¨æ–¹æ¡ˆ
- æ•°æ®ä¸å®Œæ•´ï¼Œåªæœ‰è‚¡ä¸œäººæ•°å’Œç®€åŒ–é›†ä¸­åº¦

**ä¿®å¤å**:
- âœ… ä½¿ç”¨ `cyq_perf` è·å–æ¯æ—¥ç­¹ç åŠèƒœç‡æ•°æ®ï¼ˆæœ€è¿‘30å¤©ï¼‰
- âœ… ä½¿ç”¨ `cyq_chips` è·å–æŒ‡å®šæ—¥æœŸçš„æ¯æ—¥ç­¹ç åˆ†å¸ƒæ•°æ®
- âœ… è‡ªåŠ¨å›æº¯æœ€è¿‘äº¤æ˜“æ—¥ï¼ˆå¦‚æœå½“æ—¥æ— æ•°æ®ï¼‰
- âœ… å®Œæ•´çš„æ•°æ®ç»“æ„å’Œæ±‡æ€»ä¿¡æ¯

---

## ğŸ“Š æ•°æ®æ¥å£è¯´æ˜

### cyq_perf - æ¯æ—¥ç­¹ç åŠèƒœç‡æ•°æ®

**æ¥å£**: `pro.cyq_perf(ts_code, start_date, end_date)`

**è¿”å›å­—æ®µ**ï¼ˆæ ¹æ®å®é™…è¿”å›ï¼‰:
- `ts_code`: è‚¡ç¥¨ä»£ç 
- `trade_date`: äº¤æ˜“æ—¥æœŸ
- `his_low`: å†å²æœ€ä½ä»·
- `his_high`: å†å²æœ€é«˜ä»·
- `cost_5pct`: 5%æˆæœ¬
- `cost_15pct`: 15%æˆæœ¬
- `cost_50pct`: 50%æˆæœ¬ï¼ˆä¸­ä½ï¼‰
- `cost_85pct`: 85%æˆæœ¬
- `cost_95pct`: 95%æˆæœ¬
- `weight_avg`: åŠ æƒå¹³å‡æˆæœ¬

**ç”¨é€”**: åˆ†æç­¹ç é›†ä¸­åº¦å’Œæˆæœ¬åˆ†å¸ƒ

---

### cyq_chips - æ¯æ—¥ç­¹ç åˆ†å¸ƒæ•°æ®

**æ¥å£**: `pro.cyq_chips(ts_code, trade_date)`

**è¿”å›å­—æ®µ**:
- `ts_code`: è‚¡ç¥¨ä»£ç 
- `trade_date`: äº¤æ˜“æ—¥æœŸ
- `price`: ä»·æ ¼
- `percent`: ç™¾åˆ†æ¯”

**ç”¨é€”**: è¯¦ç»†çš„ç­¹ç åˆ†å¸ƒæ•°æ®ï¼ˆä»·æ ¼-æŒä»“ç™¾åˆ†æ¯”å¯¹åº”å…³ç³»ï¼‰

---

## ğŸ”§ å®ç°ç»†èŠ‚

### 1. æ•°æ®è·å–æµç¨‹

```python
# æ­¥éª¤1: è·å–cyq_perfæ•°æ®ï¼ˆæœ€è¿‘30å¤©ï¼‰
df_perf = data_source_manager.tushare_api.cyq_perf(
    ts_code=ts_code,
    start_date=start_date,
    end_date=end_date
)

# æ­¥éª¤2: è·å–cyq_chipsæ•°æ®ï¼ˆæŒ‡å®šæ—¥æœŸï¼‰
df_chips = data_source_manager.tushare_api.cyq_chips(
    ts_code=ts_code,
    trade_date=trade_date
)

# æ­¥éª¤3: å¦‚æœå½“æ—¥æ— æ•°æ®ï¼Œè‡ªåŠ¨å›æº¯æœ€è¿‘äº¤æ˜“æ—¥
for i in range(1, 6):  # å›æº¯5ä¸ªäº¤æ˜“æ—¥
    try_date = (datetime.strptime(trade_date, '%Y%m%d') - timedelta(days=i)).strftime('%Y%m%d')
    df_chips = data_source_manager.tushare_api.cyq_chips(ts_code=ts_code, trade_date=try_date)
    if df_chips is not None and not df_chips.empty:
        break
```

---

### 2. æ•°æ®è¿”å›ç»“æ„

```python
{
    "symbol": "000001",
    "data_success": True,
    "source": "tushare",
    "latest_date": "20251031",
    "cyq_perf": {
        "data": [...],      # æœ€è¿‘30å¤©çš„æ•°æ®åˆ—è¡¨
        "latest": {...},    # æœ€æ–°ä¸€æ¡è®°å½•
        "count": 17
    },
    "cyq_chips": {
        "data": [...],      # æ¯æ—¥ç­¹ç åˆ†å¸ƒæ•°æ®
        "count": 106,
        "trade_date": "20251031"
    },
    "summary": {
        "äº¤æ˜“æ—¥æœŸ": "20251009",
        "5%æˆæœ¬": 10.0,
        "15%æˆæœ¬": 10.8,
        "50%æˆæœ¬ï¼ˆä¸­ä½ï¼‰": 11.6,
        "85%æˆæœ¬": 12.2,
        "95%æˆæœ¬": 12.8,
        "åŠ æƒå¹³å‡æˆæœ¬": 11.59,
        "å†å²æœ€ä½": 0.2,
        "å†å²æœ€é«˜": 21.2,
        "ç­¹ç é›†ä¸­åº¦": "ä¸­ç­‰",  # è‡ªåŠ¨è®¡ç®—
        "æˆæœ¬åŒºé—´": "1.40 (12.1%)",
        "æ•°æ®æœŸæ•°": 17,
        "ç­¹ç åˆ†å¸ƒæ•°æ®ç‚¹": 106,
        "ç­¹ç åˆ†å¸ƒæ—¥æœŸ": "20251031"
    }
}
```

---

### 3. ç­¹ç é›†ä¸­åº¦è®¡ç®—

**ç®—æ³•**:
```python
# è®¡ç®—æˆæœ¬åŒºé—´èŒƒå›´
cost_range = cost_85pct - cost_15pct
cost_center = cost_50pct

# è®¡ç®—é›†ä¸­åº¦ç™¾åˆ†æ¯”
concentration_pct = (cost_range / cost_center) * 100

# åˆ¤æ–­é›†ä¸­åº¦ç­‰çº§
if concentration_pct < 10:
    é›†ä¸­åº¦ = "é«˜"    # ç­¹ç é«˜åº¦é›†ä¸­
elif concentration_pct > 30:
    é›†ä¸­åº¦ = "ä½"    # ç­¹ç åˆ†æ•£
else:
    é›†ä¸­åº¦ = "ä¸­ç­‰"  # ç­¹ç é€‚ä¸­
```

**å«ä¹‰**:
- **é«˜é›†ä¸­åº¦**: æˆæœ¬åŒºé—´çª„ï¼Œç­¹ç é«˜åº¦é›†ä¸­ï¼Œä¸»åŠ›æ§ç›˜å¼º
- **ä¸­ç­‰é›†ä¸­åº¦**: æˆæœ¬åŒºé—´é€‚ä¸­ï¼Œç­¹ç åˆ†å¸ƒæ­£å¸¸
- **ä½é›†ä¸­åº¦**: æˆæœ¬åŒºé—´å®½ï¼Œç­¹ç åˆ†æ•£ï¼Œæ•£æˆ·è¾ƒå¤š

---

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯•ç»“æœ

```
âœ… æˆåŠŸè·å–ç­¹ç åˆ†å¸ƒæ•°æ®
   - cyq_perf: 17æ¡æ•°æ®
   - cyq_chips: 106æ¡æ•°æ®
   - æ•°æ®æ—¥æœŸ: 20251031
   - ç­¹ç é›†ä¸­åº¦: ä¸­ç­‰
   - æˆæœ¬åŒºé—´: 1.40 (12.1%)
```

### æ•°æ®å®Œæ•´æ€§

- âœ… cyq_perfæ•°æ®ï¼šåŒ…å«æˆæœ¬åˆ†å¸ƒå’Œå…³é”®æŒ‡æ ‡
- âœ… cyq_chipsæ•°æ®ï¼šåŒ…å«è¯¦ç»†çš„ç­¹ç åˆ†å¸ƒ
- âœ… è‡ªåŠ¨å›æº¯ï¼šå½“æ—¥æ— æ•°æ®æ—¶è‡ªåŠ¨æŸ¥æ‰¾æœ€è¿‘äº¤æ˜“æ—¥
- âœ… æ±‡æ€»ä¿¡æ¯ï¼šè‡ªåŠ¨è®¡ç®—é›†ä¸­åº¦å’Œæˆæœ¬åŒºé—´

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### è·å–ç­¹ç åˆ†å¸ƒæ•°æ®

```python
from unified_data_access import UnifiedDataAccess

unified = UnifiedDataAccess()

# è·å–æœ€æ–°ç­¹ç åˆ†å¸ƒæ•°æ®
chip_data = unified.get_chip_distribution_data("000001")

if chip_data.get('data_success'):
    # æŸ¥çœ‹æ±‡æ€»ä¿¡æ¯
    summary = chip_data.get('summary', {})
    print(f"ç­¹ç é›†ä¸­åº¦: {summary.get('ç­¹ç é›†ä¸­åº¦')}")
    print(f"åŠ æƒå¹³å‡æˆæœ¬: {summary.get('åŠ æƒå¹³å‡æˆæœ¬')}")
    print(f"æˆæœ¬åŒºé—´: {summary.get('æˆæœ¬åŒºé—´')}")
    
    # æŸ¥çœ‹æœ€æ–°cyq_perfæ•°æ®
    if chip_data.get('cyq_perf'):
        latest = chip_data['cyq_perf']['latest']
        print(f"5%æˆæœ¬: {latest.get('cost_5pct')}")
        print(f"50%æˆæœ¬: {latest.get('cost_50pct')}")
        print(f"95%æˆæœ¬: {latest.get('cost_95pct')}")
    
    # æŸ¥çœ‹cyq_chipsæ•°æ®
    if chip_data.get('cyq_chips'):
        chips = chip_data['cyq_chips']['data']
        print(f"ç­¹ç åˆ†å¸ƒæ•°æ®ç‚¹: {len(chips)}")
```

### æŒ‡å®šæ—¥æœŸè·å–

```python
# è·å–æŒ‡å®šæ—¥æœŸçš„ç­¹ç åˆ†å¸ƒæ•°æ®
chip_data = unified.get_chip_distribution_data("000001", trade_date="20251031")
```

---

## ğŸ”„ å…¨å±€å¯ç”¨æ€§

### ä¸€æ¬¡ä¿®æ”¹ï¼Œå…¨å±€å¯ç”¨

ç”±äºæ›´æ–°åœ¨ `UnifiedDataAccess` ç»Ÿä¸€æ¥å£ä¸­ï¼Œæ‰€æœ‰è°ƒç”¨ `get_chip_distribution_data()` çš„åœ°æ–¹éƒ½ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°çš„Tushareæ¥å£ï¼š

1. âœ… `app.py` - è‚¡ç¥¨åˆ†æé¡µé¢
2. âœ… `ai_agents.py` - ç­¹ç åˆ†æå¸ˆ
3. âœ… æ‰¹é‡åˆ†æåŠŸèƒ½
4. âœ… æ‰€æœ‰ä½¿ç”¨ç»Ÿä¸€æ¥å£çš„æ¨¡å—

**æ— éœ€ä¿®æ”¹è°ƒç”¨ä»£ç **ï¼Œæ¥å£ä¿æŒå…¼å®¹ã€‚

---

## ğŸ“Š æ•°æ®ä¼˜åŠ¿å¯¹æ¯”

### ä¿®å¤å‰
- âŒ åªæœ‰è‚¡ä¸œäººæ•°ï¼ˆä¸å®Œæ•´ï¼‰
- âŒ é›†ä¸­åº¦è®¡ç®—ç®€åŒ–ï¼ˆä¸å‡†ç¡®ï¼‰
- âŒ ç¼ºå°‘æˆæœ¬åˆ†å¸ƒæ•°æ®
- âŒ ç¼ºå°‘ç­¹ç åˆ†å¸ƒè¯¦æƒ…

### ä¿®å¤å
- âœ… å®Œæ•´çš„æˆæœ¬åˆ†å¸ƒæ•°æ®ï¼ˆ5%ã€15%ã€50%ã€85%ã€95%ï¼‰
- âœ… å‡†ç¡®çš„ç­¹ç é›†ä¸­åº¦è®¡ç®—
- âœ… è¯¦ç»†çš„æ¯æ—¥ç­¹ç åˆ†å¸ƒï¼ˆä»·æ ¼-æŒä»“ç™¾åˆ†æ¯”ï¼‰
- âœ… åŠ æƒå¹³å‡æˆæœ¬å’Œå†å²é«˜ä½ä»·
- âœ… è‡ªåŠ¨å›æº¯æœ€è¿‘äº¤æ˜“æ—¥æ•°æ®

---

## âœ… éªŒæ”¶æ ‡å‡†

- [x] ä½¿ç”¨Tushare cyq_perfæ¥å£è·å–æ•°æ® âœ…
- [x] ä½¿ç”¨Tushare cyq_chipsæ¥å£è·å–æ•°æ® âœ…
- [x] è‡ªåŠ¨å›æº¯æœ€è¿‘äº¤æ˜“æ—¥ âœ…
- [x] å®Œæ•´çš„æ±‡æ€»ä¿¡æ¯ âœ…
- [x] å‡†ç¡®çš„é›†ä¸­åº¦è®¡ç®— âœ…
- [x] å…¨å±€å¯ç”¨ï¼ˆä¸€æ¬¡ä¿®æ”¹ï¼‰ âœ…
- [x] æµ‹è¯•éªŒè¯é€šè¿‡ âœ…

---

**æ›´æ–°æ—¶é—´**: 2025-11-02  
**ä¿®æ”¹æ–‡ä»¶**: `unified_data_access.py`  
**ä¿®æ”¹è¡Œæ•°**: ~185è¡Œ  
**æµ‹è¯•çŠ¶æ€**: âœ… é€šè¿‡  
**æ›´æ–°çŠ¶æ€**: âœ… å·²å®Œæˆ

