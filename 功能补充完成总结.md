# åŠŸèƒ½è¡¥å……å®Œæˆæ€»ç»“

## ğŸ“‹ è¡¥å……æ¦‚è¿°

æŒ‰ç…§ã€Šæ—§ç‰ˆæ•°æ®è·å–åŠŸèƒ½å¯¹æ¯”åˆ†æ.mdã€‹ä¸­çš„å»ºè®®ï¼Œå·²å®Œæˆæ–¹æ¡ˆ1å’Œæ–¹æ¡ˆ2çš„åŠŸèƒ½è¡¥å……ï¼Œä¸æ”¹å˜ç°æœ‰ä»£ç æ•´ä½“é€»è¾‘ã€‚

**è¡¥å……æ—¶é—´**: 2025-11-02  
**ä¿®æ”¹æ–‡ä»¶**: `unified_data_access.py`  
**æ–°å¢ä»£ç è¡Œæ•°**: çº¦520è¡Œ

---

## âœ… æ–¹æ¡ˆ1ï¼šæ¢å¤é«˜çº§åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰

### 1. ETFæ•°æ®è·å–åŠŸèƒ½

**æ–¹æ³•**: `get_etf_data(symbol, start_date, end_date)`

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… Tushareä¼˜å…ˆï¼ˆä½¿ç”¨ `fund_daily` æ¥å£ï¼‰
- âœ… Akshareå¤‡ç”¨ï¼ˆä½¿ç”¨ `fund_etf_hist_sina` æ¥å£ï¼‰
- âœ… è‡ªåŠ¨è¯†åˆ«å¸‚åœºå‰ç¼€ï¼ˆsh/szï¼‰
- âœ… æ”¯æŒæ—¥æœŸèŒƒå›´æŸ¥è¯¢ï¼ˆé»˜è®¤æœ€è¿‘100å¤©ï¼‰
- âœ… ç»Ÿä¸€çš„ç½‘ç»œä¼˜åŒ–ï¼ˆ`network_optimizer.apply()`ï¼‰

**è¿”å›æ ¼å¼**: `pd.DataFrame` æˆ– `None`

---

### 2. Betaç³»æ•°è®¡ç®—åŠŸèƒ½

**æ–¹æ³•**: `get_beta_coefficient(symbol, index_code='000300.SH', days=250)`

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… ä½¿ç”¨Tushareè·å–è‚¡ç¥¨å’ŒæŒ‡æ•°æ—¥çº¿æ•°æ®
- âœ… è®¡ç®—åæ–¹å·®å’Œæ–¹å·®
- âœ… Beta = covariance / variance
- âœ… é»˜è®¤ä½¿ç”¨æ²ªæ·±300ä½œä¸ºå‚è€ƒæŒ‡æ•°
- âœ… é»˜è®¤å›æº¯250ä¸ªäº¤æ˜“æ—¥ï¼ˆçº¦1å¹´ï¼‰
- âœ… æ•°æ®éªŒè¯ï¼ˆè‡³å°‘éœ€è¦50ä¸ªäº¤æ˜“æ—¥ï¼‰

**è¿”å›æ ¼å¼**: `float` æˆ– `None`

**è®¡ç®—å…¬å¼**:
```python
Beta = Cov(è‚¡ç¥¨æ”¶ç›Šç‡, æŒ‡æ•°æ”¶ç›Šç‡) / Var(æŒ‡æ•°æ”¶ç›Šç‡)
```

---

### 3. 52å‘¨é«˜ä½ä½åŠŸèƒ½

**æ–¹æ³•**: `get_52week_high_low(symbol)`

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… è·å–è¿‡å»52å‘¨ï¼ˆ365å¤©ï¼‰çš„æ—¥çº¿æ•°æ®
- âœ… è®¡ç®—æœ€é«˜ä»·ã€æœ€ä½ä»·
- âœ… æ‰¾åˆ°é«˜ä½ä½çš„æ—¥æœŸ
- âœ… è®¡ç®—å½“å‰ä»·æ ¼åœ¨52å‘¨åŒºé—´çš„ä½ç½®ï¼ˆ0-100%ï¼‰
- âœ… è¿”å›å®Œæ•´çš„52å‘¨åˆ†ææ•°æ®

**è¿”å›æ ¼å¼**: `dict`ï¼ŒåŒ…å«ï¼š
- `success`: æ˜¯å¦æˆåŠŸ
- `high_52w`: 52å‘¨æœ€é«˜ä»·
- `low_52w`: 52å‘¨æœ€ä½ä»·
- `high_date`: æœ€é«˜ä»·æ—¥æœŸ
- `low_date`: æœ€ä½ä»·æ—¥æœŸ
- `current_price`: å½“å‰ä»·æ ¼
- `position_percent`: å½“å‰ä»·æ ¼åœ¨åŒºé—´çš„ä½ç½®ï¼ˆ%ï¼‰

---

### 4. æ¿å—èµ„é‡‘æµå‘åŠŸèƒ½

**æ–¹æ³•**: `get_sector_fund_flow(symbol)`

**åŠŸèƒ½ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨è¯†åˆ«è‚¡ç¥¨æ‰€å±è¡Œä¸š
- âœ… è·å–è¡Œä¸šèµ„é‡‘æµå‘ï¼ˆ`moneyflow_ind_ths`ï¼‰
- âœ… è·å–æ¿å—èµ„é‡‘æµå‘ï¼ˆ`moneyflow_cnt_ths`ï¼‰
- âœ… æ”¯æŒäº¤æ˜“æ—¥æ•°æ®å›é€€ï¼ˆå½“æ—¥æœªæ›´æ–°æ—¶ä½¿ç”¨å‰ä¸€æ—¥ï¼‰
- âœ… è¿”å›è¡Œä¸šå’Œæ¿å—çš„ç»¼åˆèµ„é‡‘æµå‘æ•°æ®

**è¿”å›æ ¼å¼**: `dict`ï¼ŒåŒ…å«ï¼š
- `success`: æ˜¯å¦æˆåŠŸ
- `symbol`: è‚¡ç¥¨ä»£ç 
- `sector_name`: è¡Œä¸šåç§°
- `industry_data`: è¡Œä¸šèµ„é‡‘æµå‘æ•°æ®
- `sector_data`: æ¿å—èµ„é‡‘æµå‘æ•°æ®

---

## âœ… æ–¹æ¡ˆ2ï¼šå¢å¼ºç ”æŠ¥åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰

### 1. å¢å¼ºç ”æŠ¥ç»Ÿè®¡åˆ†æ

**æ–¹æ³•**: `_analyze_research_reports(df_reports)`

**æ–°å¢ç»Ÿè®¡åˆ†æ**:
- âœ… **æœºæ„ç»Ÿè®¡**: Top5æœºæ„ç ”æŠ¥æ•°é‡
- âœ… **è¯„çº§åˆ†å¸ƒ**: è¯„çº§æ•°é‡ç»Ÿè®¡
- âœ… **è¯„çº§æ¯”ä¾‹**: ä¹°å…¥/ä¸­æ€§/å–å‡ºæ¯”ä¾‹ï¼ˆæ–°å¢ï¼‰
  - `buy_ratio`: ä¹°å…¥å»ºè®®æ¯”ä¾‹
  - `neutral_ratio`: ä¸­æ€§å»ºè®®æ¯”ä¾‹
  - `sell_ratio`: å–å‡ºå»ºè®®æ¯”ä¾‹
- âœ… **ç›®æ ‡ä»·æ ¼ç»Ÿè®¡**: æœ€é«˜/æœ€ä½/å¹³å‡ç›®æ ‡ä»·
- âœ… **è´¢åŠ¡æŒ‡æ ‡ç»Ÿè®¡**: EPS/PE/ROEçš„ç»Ÿè®¡ï¼ˆæœ€å¤§/æœ€å°/å¹³å‡ï¼‰
- âœ… **æœ€æ–°ç ”æŠ¥ä¿¡æ¯**: æœ€æ–°ç ”æŠ¥çš„è¯¦ç»†ä¿¡æ¯

**è¯„çº§è¯†åˆ«è§„åˆ™**:
- **ä¹°å…¥**: ä¹°å…¥ã€å¢æŒã€æ¨èã€å¼ºæ¨
- **ä¸­æ€§**: æŒæœ‰ã€ä¸­æ€§ã€è§‚æœ›
- **å–å‡º**: å–å‡ºã€å‡æŒã€å›é¿

---

### 2. Tushareç ”æŠ¥æ¥å£æ”¯æŒ

**æ›´æ–°æ–¹æ³•**: `get_research_reports_data(symbol, days=90)`

**æ”¹è¿›å†…å®¹**:
- âœ… **Tushareä¼˜å…ˆ**: ä½¿ç”¨ `report_rc` æ¥å£ï¼ˆä¼˜å…ˆæ•°æ®æºï¼‰
- âœ… **Akshareå¤‡ç”¨**: å¤±è´¥æ—¶é™çº§åˆ°Akshare
- âœ… **å¢å¼ºç»Ÿè®¡åˆ†æ**: è°ƒç”¨ `_analyze_research_reports()` æ–¹æ³•
- âœ… **ç»Ÿä¸€è¿”å›æ ¼å¼**: åŒ…å« `report_count`ã€`analysis_summary` ç­‰å­—æ®µ
- âœ… **é»˜è®¤å¤©æ•°**: ä»30å¤©æ”¹ä¸º90å¤©ï¼ˆä¸æ–‡æ¡£è§„èŒƒä¸€è‡´ï¼‰

**è¿”å›æ ¼å¼å¢å¼º**:
```python
{
    "symbol": str,
    "research_reports": list,        # ç ”æŠ¥åˆ—è¡¨
    "data_success": bool,
    "source": str,                   # "tushare" æˆ– "akshare"
    "report_count": int,             # ç ”æŠ¥æ€»æ•°
    "analysis_summary": {           # åˆ†ææ‘˜è¦ï¼ˆæ–°å¢ï¼‰
        "top_institutions": dict,    # Topæœºæ„
        "rating_distribution": dict, # è¯„çº§åˆ†å¸ƒ
        "rating_ratio": {           # è¯„çº§æ¯”ä¾‹ï¼ˆæ–°å¢ï¼‰
            "buy_ratio": float,
            "neutral_ratio": float,
            "sell_ratio": float
        },
        "target_price_stats": dict,  # ç›®æ ‡ä»·æ ¼ç»Ÿè®¡
        "latest_report": dict        # æœ€æ–°ç ”æŠ¥
    }
}
```

---

## ğŸ“Š ä»£ç è´¨é‡ä¿è¯

### ç»Ÿä¸€çš„å®ç°æ–¹å¼

- âœ… æ‰€æœ‰æ–°å¢åŠŸèƒ½éƒ½ä½¿ç”¨ `network_optimizer.apply()` ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- âœ… ä¸ä½¿ç”¨æ—§ç‰ˆçš„æ‰‹åŠ¨ä»£ç†ç¯å¢ƒå˜é‡ç®¡ç†æ–¹å¼
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ï¼ˆ`debug_logger`ï¼‰
- âœ… ä¸ç°æœ‰ä»£ç é£æ ¼ä¿æŒä¸€è‡´

### é”™è¯¯å¤„ç†

- âœ… å®Œå–„çš„å¼‚å¸¸æ•è·å’Œå¤„ç†
- âœ… è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
- âœ… ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### æ•°æ®éªŒè¯

- âœ… è¾“å…¥å‚æ•°éªŒè¯
- âœ… æ•°æ®æºå¯ç”¨æ€§æ£€æŸ¥
- âœ… æ•°æ®æ ¼å¼éªŒè¯
- âœ… ç©ºæ•°æ®å¤„ç†

---

## ğŸ” åŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹

### ETFæ•°æ®è·å–

```python
from unified_data_access import unified_data_access

# è·å–ETFå†å²æ•°æ®
df = unified_data_access.get_etf_data('510300', start_date='20240101')
if df is not None:
    print(f"è·å–åˆ° {len(df)} æ¡ETFæ•°æ®")
```

### Betaç³»æ•°è®¡ç®—

```python
# è®¡ç®—è‚¡ç¥¨ç›¸å¯¹äºæ²ªæ·±300çš„Betaç³»æ•°
beta = unified_data_access.get_beta_coefficient('000001', '000300.SH', days=250)
if beta is not None:
    print(f"Betaç³»æ•°: {beta:.4f}")
```

### 52å‘¨é«˜ä½ä½

```python
# è·å–52å‘¨é«˜ä½ä½æ•°æ®
result = unified_data_access.get_52week_high_low('000001')
if result['success']:
    print(f"52å‘¨é«˜: {result['high_52w']:.2f}")
    print(f"52å‘¨ä½: {result['low_52w']:.2f}")
    print(f"å½“å‰ä½ç½®: {result['position_percent']:.1f}%")
```

### æ¿å—èµ„é‡‘æµå‘

```python
# è·å–æ¿å—èµ„é‡‘æµå‘
result = unified_data_access.get_sector_fund_flow('000001')
if result['success']:
    print(f"æ‰€å±è¡Œä¸š: {result['sector_name']}")
    if result['industry_data']:
        print(f"è¡Œä¸šèµ„é‡‘æµå‘: {result['industry_data']}")
```

### ç ”æŠ¥æ•°æ®ï¼ˆå¢å¼ºç‰ˆï¼‰

```python
# è·å–ç ”æŠ¥æ•°æ®ï¼ˆåŒ…å«ç»Ÿè®¡åˆ†æï¼‰
data = unified_data_access.get_research_reports_data('000001', days=90)
if data['data_success']:
    print(f"ç ”æŠ¥æ•°é‡: {data['report_count']}")
    summary = data['analysis_summary']
    if 'rating_ratio' in summary:
        print(f"ä¹°å…¥æ¯”ä¾‹: {summary['rating_ratio']['buy_ratio']}%")
        print(f"ä¸­æ€§æ¯”ä¾‹: {summary['rating_ratio']['neutral_ratio']}%")
        print(f"å–å‡ºæ¯”ä¾‹: {summary['rating_ratio']['sell_ratio']}%")
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Tushareä¾èµ–**: å¤§éƒ¨åˆ†é«˜çº§åŠŸèƒ½éœ€è¦Tushareæ”¯æŒï¼Œè¯·ç¡®ä¿å·²é…ç½® `TUSHARE_TOKEN`
2. **æ•°æ®å¯ç”¨æ€§**: æŸäº›æ¥å£å¯èƒ½éœ€è¦Tushareé«˜çº§æƒé™
3. **ç½‘ç»œä¼˜åŒ–**: æ‰€æœ‰Akshareè°ƒç”¨éƒ½é€šè¿‡ `network_optimizer.apply()` è¿›è¡Œç½‘ç»œä¼˜åŒ–
4. **æ—¥æœŸæ ¼å¼**: æ‰€æœ‰æ—¥æœŸå‚æ•°æ”¯æŒ `YYYYMMDD` å’Œ `YYYY-MM-DD` ä¸¤ç§æ ¼å¼

---

## ğŸ¯ åç»­å»ºè®®

### å¯é€‰ä¼˜åŒ–ï¼ˆæ–¹æ¡ˆ3ï¼Œæš‚æœªé‡‡çº³ï¼‰

1. **ç»Ÿä¸€æ¥å£å‘½å**: æ£€æŸ¥å¹¶ç»Ÿä¸€ `data_source_manager` å’Œ `unified_data_access` çš„æ¥å£å‘½å
2. **å¢å¼ºé”™è¯¯å¤„ç†**: æ·»åŠ æ›´è¯¦ç»†çš„ç±»å‹æ£€æŸ¥å’Œé”™è¯¯æç¤º
3. **æ¥å£æ–‡æ¡£**: ç”Ÿæˆå®Œæ•´çš„APIæ–‡æ¡£

---

## âœ… éªŒè¯æ¸…å•

- [x] æ‰€æœ‰æ–°å¢åŠŸèƒ½å·²å®ç°
- [x] ä»£ç é€šè¿‡è¯­æ³•æ£€æŸ¥ï¼ˆlintï¼‰
- [x] ä½¿ç”¨ç»Ÿä¸€çš„ç½‘ç»œä¼˜åŒ–æ–¹å¼
- [x] æ·»åŠ äº†å®Œæ•´çš„æ—¥å¿—è®°å½•
- [x] ä¿æŒäº†ç°æœ‰ä»£ç é£æ ¼
- [x] æœªæ”¹å˜ç°æœ‰ä»£ç æ•´ä½“é€»è¾‘
- [x] æ‰€æœ‰åŠŸèƒ½éƒ½æœ‰é”™è¯¯å¤„ç†

---

**è¡¥å……å®Œæˆæ—¶é—´**: 2025-11-02  
**ä¿®æ”¹æ–‡ä»¶**: `unified_data_access.py`  
**æ–°å¢æ–¹æ³•**: 6ä¸ªï¼ˆ4ä¸ªé«˜çº§åŠŸèƒ½ + 1ä¸ªå¢å¼ºåˆ†æ + 1ä¸ªè¾…åŠ©æ–¹æ³•ï¼‰  
**ä»£ç è¡Œæ•°**: çº¦520è¡Œ

